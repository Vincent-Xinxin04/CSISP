# CSISP ç»¼åˆæœåŠ¡å¹³å° - æŠ€æœ¯æ¶æ„æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

CSISPï¼ˆComputer Science Integrated Service Platformï¼‰æ˜¯ä¸€ä¸ªåŸºäºç°ä»£æŠ€æœ¯æ ˆçš„ Monorepo æ¶æ„çš„æ•™è‚²ç®¡ç†ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿä¸ºå­¦æ ¡æä¾›å®Œæ•´çš„æ•™å­¦ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç”¨æˆ·ç®¡ç†ã€è¯¾ç¨‹ç®¡ç†ã€ç­çº§ç®¡ç†ã€è€ƒå‹¤ç®¡ç†ã€ä½œä¸šç®¡ç†ç­‰åŠŸèƒ½ã€‚

æ¶æ„è®¾è®¡éµå¾ªæ¨¡å—åŒ–ã€å¯å¤ç”¨ã€å¯æ‰©å±•çš„åŸåˆ™ï¼Œæ”¯æŒå‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œä¸ºæ•™å¸ˆã€å­¦ç”Ÿå’Œç®¡ç†å‘˜æä¾›ä¸åŒçš„ç”¨æˆ·ç•Œé¢å’ŒåŠŸèƒ½ä½“éªŒã€‚

## æŠ€æœ¯æ ˆé€‰å‹

### backend-integrated æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: NestJS
- **æ•°æ®åº“**: PostgreSQL + Redis
- **è¯­è¨€**: TypeScript
- **æ„å»ºå·¥å…·**: tsxï¼ˆå¼€å‘ï¼‰
- **ORM**: Sequelizeï¼ˆåŠ¨æ€ ESM åŠ è½½ï¼Œæ¨¡å‹å…³è”ç»Ÿä¸€åœ¨ `infra/postgres` ä¸­æ‰§è¡Œï¼‰
- **è®¤è¯**: JWTï¼ˆåŸºäºè§’è‰²ä¸æƒé™ç¼–ç ï¼‰
- **ç¼“å­˜**: Redisï¼ˆé€šè¿‡ `@csisp/redis`ï¼Œåœ¨ backend-integrated ä¸­ç» `@infra/redis` å°è£…ä½¿ç”¨ï¼‰
- **æ—¥å¿—**: ç»“æ„åŒ–æ—¥å¿—ï¼ˆ`@csisp/logger` + pinoï¼Œç» LoggingInterceptor / HttpExceptionFilter è¾“å‡º JSONï¼‰
- **å¼‚å¸¸å¤„ç†**: Nest å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨ï¼ˆç»Ÿä¸€ `{ code, message }` å“åº”ï¼‰

### BFF æŠ€æœ¯æ ˆ

- **åº”ç”¨**: `apps/bff`ï¼ˆKoa 3.x + TypeScriptï¼‰
- **æ¡†æ¶**: Koa 3.x
- **è·¯ç”±**: `@koa/router`
- **è¯·æ±‚è§£æ**: `koa-bodyparser`
- **HTTP å®¢æˆ·ç«¯**: `undici`ï¼ˆé€šè¿‡ `@csisp/upstream` å°è£…ï¼Œæ”¯æŒ pino ç»“æ„åŒ–ä¸Šæ¸¸æ—¥å¿—ï¼‰
- **é…ç½®**: `dotenv`
- **æ„å»º / è¿è¡Œ**: tsx + esbuild

### å‰ç«¯ä¸­å°åº”ç”¨æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Vue 3 + Composition API
- **æ„å»ºå·¥å…·**: Vite
- **è¯­è¨€**: TypeScript
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±**: Vue Router
- **ç»„ä»¶åº“**ï¼šNaive-UI
- **å›¾è¡¨åº“**ï¼šEChartsï¼ˆä»ªè¡¨ç›˜ç­‰åœºæ™¯ï¼‰

### æµ‹è¯•æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Vitestï¼ˆ`apps/*` ä¸ `tests/` ç»Ÿä¸€ä½¿ç”¨ï¼‰
- **ç±»å‹**: å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•

## ğŸ“ ç›®å½•ç»“æ„è¯¦è§£

### æ ¹ç›®å½•ç»“æ„

```
CSISP/
â”œâ”€â”€ ğŸ“ apps/                          # åº”ç”¨å±‚ - å¯ç‹¬ç«‹éƒ¨ç½²çš„åº”ç”¨
â”‚   â”œâ”€â”€ ğŸ“ backend-integrated/        # NestJS é›†æˆåç«¯ï¼ˆæ¨èæ¥å…¥ç‚¹ï¼‰
â”‚   â”œâ”€â”€ ğŸ“ bff/                       # BFF èšåˆå±‚ï¼ˆå¯¹æ¥å‰ç«¯ä¸åç«¯ï¼‰
â”‚   â”œâ”€â”€ ğŸ“ frontend-admin/            # ä¸­å°ç®¡ç†ç³»ç»Ÿå‰ç«¯
â”‚   â””â”€â”€ ğŸ“ frontend-portal/           # é—¨æˆ·ï¼ˆå­¦ç”Ÿ/æ•™å¸ˆï¼‰å‰ç«¯
â”œâ”€â”€ ğŸ“ packages/                      # å…±äº«åŒ…å±‚ - å¯å¤ç”¨çš„ä»£ç æ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“ types/                     # å…±äº«ç±»å‹å®šä¹‰ï¼ˆ@csisp/typesï¼‰
â”‚   â”œâ”€â”€ ğŸ“ redis/                     # Redis å®¢æˆ·ç«¯å°è£…ï¼ˆ@csisp/redisï¼‰
â”‚   â”œâ”€â”€ ğŸ“ upstream/                  # ä¸Šæ¸¸ HTTP å®¢æˆ·ç«¯å°è£…ï¼ˆ@csisp/upstreamï¼‰
â”‚   â”œâ”€â”€ ğŸ“ utils/                     # å·¥å…·å‡½æ•°ï¼ˆ@csisp/utilsï¼‰
â”‚   â””â”€â”€ ğŸ“ db-schema/                 # æ•°æ®åº“è¿ç§»ä¸æ¨¡å‹å®šä¹‰ï¼ˆ@csisp/db-schemaï¼‰
â”œâ”€â”€ ğŸ“ docs/                          # æ–‡æ¡£å±‚ - é¡¹ç›®æ–‡æ¡£å’ŒæŒ‡å—
â”œâ”€â”€ ğŸ“ infra/                         # åŸºç¡€è®¾æ–½è„šæœ¬ï¼ˆå¦‚æ•°æ®åº“ docker-composeï¼‰
â”œâ”€â”€ ğŸ“ tests/                         # æµ‹è¯•å±‚ - æµ‹è¯•ç›¸å…³æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ package.json                   # Monorepo æ ¹é…ç½®
â”œâ”€â”€ ğŸ“„ pnpm-workspace.yaml            # pnpm å·¥ä½œåŒºé…ç½®
â”œâ”€â”€ ğŸ“„ .gitignore                     # Git å¿½ç•¥é…ç½®
â””â”€â”€ ğŸ“„ .gitattributes                 # Git å±æ€§é…ç½®
```

### 1. åº”ç”¨å±‚ (apps/)

#### åç«¯åº”ç”¨ç»“æ„ï¼ˆbackend-integratedï¼‰

**backend-integratedï¼ˆapps/backend-integratedï¼ŒNestJSï¼‰**

```
apps/backend-integrated/
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ ğŸ“„ main.ts                    # Nest åº”ç”¨å…¥å£ï¼ˆåŠ è½½ .envï¼Œåˆå§‹åŒ– Redisï¼Œå¯åŠ¨ HTTP æœåŠ¡ï¼‰
â”‚   â”œâ”€â”€ ï¿½ app.module.ts              # æ ¹æ¨¡å—ï¼Œè£…é… PostgresModule ä¸ä¸šåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“ infra/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ postgres/              # Sequelize æ¨¡å‹åŠ¨æ€åŠ è½½ä¸å…³è”ï¼ˆPOSTGRES_MODELSï¼‰
â”‚   â”‚   â””â”€â”€ ğŸ“ redis/                 # Redis åŸºç¡€è®¾æ–½å°è£…ï¼ˆ@infra/redisï¼‰
â”‚   â”œâ”€â”€ ğŸ“ common/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ guards/                # JwtAuthGuard / RolesGuard ç­‰
â”‚   â”‚   â”œâ”€â”€ ğŸ“ interceptors/          # LoggingInterceptor / RateLimitInterceptor
â”‚   â”‚   â”œâ”€â”€ ğŸ“ filters/               # HttpExceptionFilter
â”‚   â”‚   â””â”€â”€ ğŸ“ pipes/                 # ParseIdPipe / PaginationPipe ç­‰
â”‚   â””â”€â”€ ï¿½ modules/
â”‚       â”œâ”€â”€ ğŸ“ user/                  # ç”¨æˆ·æ¨¡å—ï¼ˆUserController + UserServiceï¼‰
â”‚       â”œâ”€â”€ ğŸ“ course/                # è¯¾ç¨‹æ¨¡å—
â”‚       â”œâ”€â”€ ï¿½ attendance/            # è€ƒå‹¤æ¨¡å—
â”‚       â”œâ”€â”€ ï¿½ homework/              # ä½œä¸šæ¨¡å—
â”‚       â”œâ”€â”€ ğŸ“ dashboard/             # ä»ªè¡¨ç›˜æ¨¡å—
â”‚       â””â”€â”€ ï¿½ health/                # å¥åº·æ£€æŸ¥æ¨¡å—ï¼ˆ/api/healthï¼‰
â”œâ”€â”€ ğŸ“„ package.json
â””â”€â”€ ğŸ“„ tsconfig.json
```

### 2. Redis éƒ¨ç½²ä¸å‘½åè§„èŒƒ

ä¸ºç®€åŒ–è¿ç»´ä¸ä¿è¯ä¸€è‡´æ€§ï¼ŒRedis åœ¨ä¸åŒç¯å¢ƒæŒ‰ã€Œä¸€ç¯å¢ƒä¸€å®ä¾‹ã€è¿›è¡Œéƒ¨ç½²ï¼š

- Developmentï¼šæœ¬åœ°é€šè¿‡ `infra/database/docker-compose.db.yml` å¯åŠ¨ `postgres + redis`
- Stagingï¼šé¢„å‘/è”è°ƒç¯å¢ƒä½¿ç”¨ç‹¬ç«‹ Redis å®ä¾‹
- Productionï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç‹¬ç«‹ Redis å®ä¾‹ï¼ˆå¯æŒ‰éœ€æ‰©å±•ä¸ºä¸»ä»æˆ–é›†ç¾¤ï¼‰

åº”ç”¨ä¾§é€šè¿‡ `@csisp/redis` ç»Ÿä¸€è®¿é—® Redisï¼š

- è¿æ¥ä¿¡æ¯ï¼šä»æ ¹ `.env` è¯»å– `REDIS_HOST/REDIS_PORT/REDIS_DB/REDIS_PASSWORD`
- å‘½åç©ºé—´ï¼š`REDIS_NAMESPACE`ï¼Œé»˜è®¤ `csisp`ï¼Œåœ¨å®¢æˆ·ç«¯å†…éƒ¨ä½œä¸ºå…¨å±€å‰ç¼€
- é€»è¾‘éš”ç¦»ï¼š
  - BFFï¼š`csisp:bff:*`
  - Backendï¼š`csisp:be:*`ï¼ˆåœ¨ backend-integrated ä¸­é€šè¿‡ `@infra/redis` ä½¿ç”¨ï¼‰
  - åç»­å¦‚éœ€æ–°å¢ç³»ç»Ÿï¼Œå¯é€šè¿‡æ–°çš„å‘½åç©ºé—´æˆ–å‰ç¼€æ‰©å±•

æ¨èçš„é”®è®¾è®¡ç¤ºä¾‹ï¼š

```text
csisp:bff:dashboard:summary:<userId>      # BFF å­¦ç”Ÿä»ªè¡¨ç›˜èšåˆç¼“å­˜
csisp:be:course:detail:<courseId>         # åç«¯è¯¾ç¨‹è¯¦æƒ…ç¼“å­˜
csisp:be:rate-limit:user:<userId>         # ç”¨æˆ·çº§é™æµè®¡æ•°ï¼ˆæœªæ¥å¯æ‰©å±•ï¼‰
```

ç¼“å­˜è¯»å†™éµå¾ªã€ŒCache-Asideã€æ¨¡å¼ï¼š

```mermaid
flowchart LR
  A[å®¢æˆ·ç«¯è¯·æ±‚] --> B[æœåŠ¡è¯»å–ç¼“å­˜]
  B -->|å‘½ä¸­| C[ç›´æ¥è¿”å›ç¼“å­˜]
  B -->|æœªå‘½ä¸­| D[æŸ¥è¯¢ PostgreSQL]
  D --> E[å†™å…¥ Redis ç¼“å­˜]
  E --> C
```

è¯´æ˜ï¼š

- ä¸ä»¥ Redis ä½œä¸ºæƒå¨æ•°æ®æºï¼Œæ‰€æœ‰æŒä¹…ä¸šåŠ¡æ•°æ®ä»ç”± PostgreSQL æ‰¿è½½
- ä¸å»ºè®®ç”¨ä¸€ä¸ª Redis å®ä¾‹æ‰¿è½½ dev/staging/prod çš„æ•°æ®éš”ç¦»ï¼Œç¯å¢ƒéš”ç¦»åº”é€šè¿‡ã€Œä¸åŒå®ä¾‹ + ä¸åŒ `.env`ã€å®Œæˆ
- å‘½åç©ºé—´ä¸å‰ç¼€ä¸»è¦ç”¨äºåŒºåˆ†ç³»ç»Ÿä¸ä¸šåŠ¡åŸŸï¼Œè€ŒéåŒºåˆ†ç¯å¢ƒ

### Backend ç¼“å­˜ä¸å¤±æ•ˆçº¦å®š

- é”®å‘½åï¼š`csisp:be:<domain>:<entity>[:<scope>]...`ï¼›åˆ†é¡µé”®è¿½åŠ  `page/size`ï¼Œç­›é€‰æ¡ä»¶ä»¥ `key=value` å½¢å¼æ‹¼æ¥ã€‚
- TTLï¼šè¯¦æƒ…/åˆ†å¸ƒ 300sï¼›åˆ—è¡¨ 120sï¼›ç»Ÿè®¡/æ´»è·ƒ 30â€“60sï¼›è§’è‰²/å­¦å·æŸ¥è¯¢ 600sã€‚
- å¤±æ•ˆï¼šå†™æ“ä½œååˆ é™¤ç²¾ç¡®é”®ï¼ˆè¯¦æƒ…/ç»Ÿè®¡ï¼‰ï¼›åˆ—è¡¨åˆ†é¡µä»¥çŸ­ TTL ä¸ºä¸»ï¼Œå¿…è¦æ—¶æšä¸¾å¸¸ç”¨é¡µåˆ é™¤ï¼›å¯é€‰äº‹ä»¶å¹¿æ’­é€šçŸ¥ BFF å¤±æ•ˆã€‚
- æ¥å…¥ä½ç½®ï¼šbackend-integrated çš„ Service å±‚é€šè¿‡ `@infra/redis`ï¼ˆå†…éƒ¨è½¬å‘åˆ° `@csisp/redis`ï¼‰è®¿é—®ç¼“å­˜ã€‚
- é™çº§ï¼š`REDIS_ENABLED=false` æ—¶ä¸å¯ç”¨ç¼“å­˜ï¼›Redis å¼‚å¸¸ä¸å½±å“ä¸»ä¸šåŠ¡è·¯å¾„ã€‚

#### å‰ç«¯ä¸­å°åº”ç”¨ç»“æ„ï¼ˆVite è„šæ‰‹æ¶åˆ›å»ºï¼‰

```
apps/frontend-admin/
â”œâ”€â”€ ğŸ“ src/                           # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ components/                # ç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ ğŸ“ common/                # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ layout/                # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ user/                  # ç”¨æˆ·ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ course/                # è¯¾ç¨‹ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ class/                 # ç­çº§ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ attendance/            # è€ƒå‹¤ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ homework/              # ä½œä¸šç›¸å…³ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts              # ç»„ä»¶å¯¼å‡ºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ layout/                    # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AdminLayout.vue       # ä¸­å°ç®¡ç†å¸ƒå±€
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts              # å¸ƒå±€ç»„ä»¶å¯¼å‡ºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ pages/                     # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ dashboard/             # ä»ªè¡¨ç›˜é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ user-management/       # ç”¨æˆ·ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ class-management/      # ç­çº§ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ course-management/     # è¯¾ç¨‹ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ attendance/            # è€ƒå‹¤ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ homework/              # ä½œä¸šç®¡ç†é¡µé¢
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts              # é¡µé¢ç»„ä»¶å¯¼å‡ºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ stores/                    # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“ user/                  # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ ğŸ“ course/                # è¯¾ç¨‹çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ ğŸ“ class/                 # ç­çº§çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ ğŸ“ attendance/            # è€ƒå‹¤çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ ğŸ“ homework/              # ä½œä¸šçŠ¶æ€
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts              # çŠ¶æ€ç®¡ç†å¯¼å‡ºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ ğŸ“ api/                   # APIå·¥å…·
â”‚   â”‚   â”œâ”€â”€ ğŸ“ auth/                  # è®¤è¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ ğŸ“ validation/            # éªŒè¯å·¥å…·
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts              # å·¥å…·å‡½æ•°å¯¼å‡ºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ assets/                    # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ ğŸ“ images/                # å›¾ç‰‡èµ„æº
â”‚   â”‚   â””â”€â”€ ğŸ“ icons/                  # å›¾æ ‡èµ„æº
â”‚   â”œâ”€â”€ ğŸ“ styles/                    # æ ·å¼æ–‡ä»¶ï¼ˆä¸assetså¹³çº§ï¼‰
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ variables.scss        # å˜é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ mixins.scss           # æ··åˆå™¨
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.scss             # æ ·å¼å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ types/                     # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts              # ç±»å‹å®šä¹‰å¯¼å‡ºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ main.ts                    # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ router.ts                   # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ ğŸ“„ App.vue                    # æ ¹ç»„ä»¶
â”œâ”€â”€ ğŸ“ public/                        # å…¬å…±èµ„æº
â”œâ”€â”€ ğŸ“„ package.json                   # ä¾èµ–ç®¡ç†
â”œâ”€â”€ ğŸ“„ vite.config.ts                 # Vite é…ç½®
â”œâ”€â”€ ğŸ“„ tsconfig.json                  # TypeScript é…ç½®
â”œâ”€â”€ ğŸ“„ vitest.config.ts               # æµ‹è¯•é…ç½®
â””â”€â”€ ğŸ“„ .env.example                   # ç¯å¢ƒå˜é‡ç¤ºä¾‹
```

### 2. å…±äº«åŒ…å±‚ (packages/)

> æ ¸å¿ƒå…±äº«èƒ½åŠ›é€šè¿‡ `packages/*` æš´éœ²ï¼Œä¾› backend-integratedã€BFF ä¸å‰ç«¯å¤ç”¨ã€‚

```
packages/
â”œâ”€â”€ ğŸ“ types/         # @csisp/typesï¼šå…±äº«ä¸šåŠ¡ç±»å‹ä¸ API/DTO å®šä¹‰
â”œâ”€â”€ ğŸ“ redis/         # @csisp/redisï¼šRedis å®¢æˆ·ç«¯å°è£…
â”œâ”€â”€ ğŸ“ upstream/      # @csisp/upstreamï¼šHTTP ä¸Šæ¸¸å®¢æˆ·ç«¯å°è£…
â”œâ”€â”€ ğŸ“ utils/         # @csisp/utilsï¼šé€šç”¨å·¥å…·å‡½æ•°
â””â”€â”€ ğŸ“ db-schema/     # @csisp/db-schemaï¼šæ•°æ®åº“è¿ç§»ä¸æ¨¡å‹å®šä¹‰
```

### 3. å·¥å…·é…ç½®ï¼ˆæ ¹ç›®å½•ï¼‰

> å·¥å…·é…ç½®é›†ä¸­åœ¨ä»“åº“æ ¹ç›®å½•ï¼Œç”±å„åº”ç”¨æŒ‰éœ€ç»§æ‰¿æˆ–æ‰©å±•ã€‚

```
CSISP/
â”œâ”€â”€ ğŸ“„ eslint.config.ts                # ESLint 9 æ‰å¹³åŒ–é…ç½®
â”œâ”€â”€ ğŸ“„ .prettierrc                     # Prettier é…ç½®
â”œâ”€â”€ ğŸ“„ .editorconfig                   # EditorConfig é…ç½®
â”œâ”€â”€ ğŸ“„ tsconfig.json                   # æ ¹ TS é…ç½®ï¼ˆè¢« apps/* ç»§æ‰¿ï¼‰
â””â”€â”€ ğŸ“„ tsconfig.node.json              # Node ç¯å¢ƒä¸‹çš„ TS é…ç½®
```

### 4. æ–‡æ¡£å±‚ (docs/)

```
docs/
â”œâ”€â”€ ğŸ“„ index.md                        # æ–‡æ¡£é¦–é¡µ
â”œâ”€â”€ ğŸ“ .vitepress/                     # VitePress é…ç½®
â”‚   â””â”€â”€ ğŸ“„ config.ts
â”œâ”€â”€ ğŸ“ src/                            # å„å­æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“ architecture/               # æ¶æ„æ–‡æ¡£ï¼ˆå½“å‰æ–‡ä»¶ç­‰ï¼‰
â”‚   â”œâ”€â”€ ğŸ“ backend/                    # åç«¯è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“ bff/                        # BFF è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“ business/                   # ä¸šåŠ¡æµç¨‹ä¸ç”¨ä¾‹
â”‚   â”œâ”€â”€ ğŸ“ database/                   # æ•°æ®åº“ä¸ç±»å‹è®¾è®¡
â”‚   â””â”€â”€ ğŸ“ frontend/                   # å‰ç«¯ä¸­å°è®¾è®¡
â””â”€â”€ ğŸ“„ package.json                    # æ–‡æ¡£ç«™ç‚¹ä¾èµ–
```

### 5. CI/CD å±‚ (.github/)

```
.github/
â”œâ”€â”€ ğŸ“ workflows/
â”‚   â”œâ”€â”€ ğŸ“„ deploy-docs.yml             # æ–‡æ¡£ç«™ç‚¹æ„å»ºä¸éƒ¨ç½²
â”‚   â””â”€â”€ ğŸ“„ sync-env-variables.yml      # ç¯å¢ƒå˜é‡åŒæ­¥åˆ°äº‘ç«¯
```

## ğŸ”§ æ ¸å¿ƒé…ç½®æ–‡ä»¶è¯´æ˜

### 1. æ ¹ç›®å½•é…ç½®

#### package.json (Monorepo æ ¹é…ç½®)

```json
{
  "name": "csisp-monorepo",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "pnpm -r --parallel dev",
    "build": "pnpm -r build",
    "test": "pnpm -r test",
    "lint": "pnpm -r lint",
    "clean": "pnpm -r clean",
    "dev:admin": "pnpm --filter frontend-admin dev",
    "dev:client": "pnpm --filter frontend-client dev",
    "dev:backend": "pnpm --filter backend dev",
    "build:admin": "pnpm --filter frontend-admin build",
    "build:client": "pnpm --filter frontend-client build",
    "build:backend": "pnpm --filter backend build"
  },
  "packageManager": "pnpm@8.15.0",
  "workspaces": ["apps/*", "packages/*"],
  "devDependencies": {
    "@types/node": "^20.10.0",
    "typescript": "^5.3.0"
  }
}
```

#### pnpm-workspace.yaml

```yaml
packages:
  - 'apps/*'
  - 'packages/*'

hoist-pattern:
  - '*'

resolution-mode: 'highest'
```

### 2. åç«¯æ ¸å¿ƒé…ç½®

#### esbuild.config.js

```javascript
import { build } from 'esbuild';

export default {
  entryPoints: ['app.ts'],
  bundle: true,
  platform: 'node',
  target: 'node20',
  outdir: 'dist',
  format: 'esm',
  sourcemap: true,
};
```

## ğŸ§­ backend-integrated å¯åŠ¨ä¸è¯·æ±‚æµç¨‹æ¦‚è§ˆ

> è¯¦ç»†çš„å¯åŠ¨è„šæœ¬ä¸æœ¬åœ°å¼€å‘å‘½ä»¤ä»¥å„åº”ç”¨ç›®å½•ä¸‹çš„ README ä¸ package.json ä¸ºå‡†ï¼Œæœ¬èŠ‚ä»…æè¿°æ•´ä½“æµç¨‹ã€‚

```mermaid
sequenceDiagram
  participant Dev as å¼€å‘è€…
  participant Main as apps/backend-integrated/src/main.ts
  participant Nest as NestFactory
  participant AppMod as AppModule
  participant PG as PostgresModule
  participant Models as loadModelsAndAssociations

  Dev->>Main: pnpm --filter @csisp/backend-integrated dev
  Main->>Main: åŠ è½½æ ¹ .env ä¸ apps/backend-integrated/.env
  Main->>Main: è‹¥ REDIS_ENABLED=trueï¼Œåˆ™ connectRedis()
  Main->>Nest: NestFactory.create(AppModule)
  Nest->>AppMod: æ„å»ºæ¨¡å—ä¾èµ–å›¾
  AppMod->>PG: åˆå§‹åŒ– Sequelize å®ä¾‹
  PG->>Models: loadModelsAndAssociations(sequelize)
  Models-->>PG: è¿”å› models å¹¶å»ºç«‹å…³è”
  Nest-->>Main: åº”ç”¨å®ä¾‹å°±ç»ª
  Main->>Main: æ³¨å†Œæ‹¦æˆªå™¨/è¿‡æ»¤å™¨/CORS
  Main->>Main: app.listen(BACKEND_INTEGRATED_PORT)
```

```mermaid
flowchart LR
  Client --> Nest[å…¨å±€æ‹¦æˆªå™¨/è¿‡æ»¤å™¨\nRateLimit + Logging + HttpException]
  Nest --> Guard[JwtAuthGuard / RolesGuard]
  Guard --> Ctrl[Controller å‚æ•°è§£æ + æ ¡éªŒ]
  Ctrl --> Svc[Service ä¸šåŠ¡é€»è¾‘]
  Svc --> ORM[Sequelize Models]
  ORM --> PG[(PostgreSQL)]
  PG --> ORM
  ORM --> Svc
  Svc --> Ctrl
  Ctrl --> Nest
  Nest --> Client
```
