# CSISP åç«¯åˆå§‹åŒ–è„šæœ¬å·¥ä½œåŸç†è¯¦è§£

æœ¬æ–‡æ¡£è¯¦ç»†å‰–æ CSISP åç«¯é¡¹ç›®åˆå§‹åŒ–è„šæœ¬çš„å·¥ä½œæœºåˆ¶ï¼Œè§£é‡Šè„šæœ¬ä¸­æ¯ä¸ªç¯èŠ‚çš„è®¾è®¡ç›®çš„å’Œå®ç°ç»†èŠ‚ï¼Œå¸®åŠ©å¼€å‘è€…ç†è§£è‡ªåŠ¨åŒ–ç¯å¢ƒé…ç½®çš„å®Œæ•´æµç¨‹ã€‚æœ¬æŒ‡å—æ¶µç›–äº†ä¸‰ä¸ªæ“ä½œç³»ç»Ÿï¼ˆmacOSã€Linuxå’ŒWindowsï¼‰çš„åˆå§‹åŒ–è„šæœ¬å®ç°ã€‚

## 1. è„šæœ¬æ¦‚è¿°

CSISP é¡¹ç›®æä¾›äº†ä¸‰ä¸ªåˆå§‹åŒ–è„šæœ¬ï¼Œåˆ†åˆ«é€‚ç”¨äºä¸åŒæ“ä½œç³»ç»Ÿï¼š

- `init_mac.sh` - é€‚ç”¨äº macOS ç³»ç»Ÿï¼Œä½¿ç”¨ Bash ç¼–å†™
- `init_linux.sh` - é€‚ç”¨äº Linux ç³»ç»Ÿï¼Œä½¿ç”¨ Bash ç¼–å†™
- `init_windows.bat` - é€‚ç”¨äº Windows ç³»ç»Ÿï¼Œä½¿ç”¨ Batch ç¼–å†™

è¿™ä¸‰ä¸ªè„šæœ¬çš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š

- **æ ‡å‡†åŒ–å¼€å‘ç¯å¢ƒ**ï¼šç¡®ä¿æ‰€æœ‰å¼€å‘è€…ä½¿ç”¨å®Œå…¨ä¸€è‡´çš„å¼€å‘é…ç½®
- **é™ä½å…¥é—¨é—¨æ§›**ï¼šç®€åŒ–ç¯å¢ƒæ­å»ºæµç¨‹ï¼Œé¿å…æ‰‹åŠ¨é…ç½®é”™è¯¯
- **æé«˜å¼€å‘æ•ˆç‡**ï¼šä¸€é”®å®Œæˆä»ç¯å¢ƒæ£€æŸ¥åˆ°æœåŠ¡å¯åŠ¨çš„å…¨æµç¨‹

æ‰€æœ‰è„šæœ¬éƒ½ä½äº `apps/backend/scripts/` ç›®å½•ä¸‹ï¼Œå¹¶éµå¾ªä¸¥æ ¼çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚

## 2. è„šæœ¬åŸºç¡€ç»“æ„ä¸é”™è¯¯å¤„ç†

### 2.1 ä¸¥æ ¼æ¨¡å¼ä¸ç¯å¢ƒæ£€æŸ¥

#### 2.1.1 macOS å’Œ Linux è„šæœ¬çš„ä¸¥æ ¼æ¨¡å¼

```bash
# å¯ç”¨ä¸¥æ ¼æ¨¡å¼
set -euo pipefail

# OS Check - æ“ä½œç³»ç»Ÿç‰¹å®šæ£€æŸ¥
if [[ "$(uname -s)" != "Darwin" ]]; then  # macOS ç‰ˆæœ¬
    log_error "é”™è¯¯ï¼šæ­¤è„šæœ¬ä»…é€‚ç”¨äº macOS æ“ä½œç³»ç»Ÿ"
    # åç»­æç¤ºä¿¡æ¯...
fi

# æˆ– Linux ç‰ˆæœ¬çš„æ£€æŸ¥
if [[ "$(uname -s)" != "Linux" ]]; then
    log_error "é”™è¯¯ï¼šæ­¤è„šæœ¬ä»…é€‚ç”¨äº Linux æ“ä½œç³»ç»Ÿ"
    # åç»­æç¤ºä¿¡æ¯...
fi
```

#### 2.1.2 Windows è„šæœ¬çš„ç¯å¢ƒé…ç½®

```batch
@echo off
chcp 65001 >nul

:: å¯ç”¨å»¶è¿Ÿç¯å¢ƒå˜é‡æ‰©å±•
setlocal enabledelayedexpansion

:: OS Check - Only for Windows
ver | findstr "Windows" >nul 2>&1
if errorlevel 1 (
    call :log_error "é”™è¯¯ï¼šæ­¤è„šæœ¬ä»…é€‚ç”¨äº Windows æ“ä½œç³»ç»Ÿ"
    rem åç»­æç¤ºä¿¡æ¯...
)
```

**è®¾è®¡ç›®çš„**ï¼š

- å¯¹äº macOS å’Œ Linuxï¼Œ`set -euo pipefail` ç¡®ä¿è„šæœ¬åœ¨é‡åˆ°é”™è¯¯æ—¶ç«‹å³é€€å‡ºï¼Œé¿å…åœ¨é”™è¯¯çŠ¶æ€ä¸‹ç»§ç»­æ‰§è¡Œ
- å¯¹äº Windowsï¼Œ`setlocal enabledelayedexpansion` å…è®¸åœ¨ for å¾ªç¯å’Œ if è¯­å¥ä¸­ä½¿ç”¨å»¶è¿Ÿçš„ç¯å¢ƒå˜é‡æ‰©å±•
- å„å¹³å°çš„æ“ä½œç³»ç»Ÿæ£€æŸ¥ç¡®ä¿è„šæœ¬åªåœ¨å…¼å®¹çš„ç³»ç»Ÿä¸Šè¿è¡Œï¼Œé˜²æ­¢åœ¨ä¸å…¼å®¹çš„ç³»ç»Ÿä¸Šæ‰§è¡Œå¯¼è‡´çš„é—®é¢˜

### 2.2 æ—¥å¿—ç³»ç»Ÿè®¾è®¡

#### 2.2.1 macOS å’Œ Linux æ—¥å¿—ç³»ç»Ÿ

```bash
# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# æ—¥å¿—å‡½æ•°
log_info() { echo -e "${BLUE}ğŸ” ${1}${NC}"; }
log_success() { echo -e "${GREEN}âœ… ${1}${NC}"; }
log_warning() { echo -e "${YELLOW}âš ï¸  ${1}${NC}"; }
log_error() { echo -e "${RED}âŒ ${1}${NC}"; }
```

#### 2.2.2 Windows æ—¥å¿—ç³»ç»Ÿ

```batch
:: é¢œè‰²å®šä¹‰ï¼ˆWindows å‘½ä»¤æç¤ºç¬¦é¢œè‰²ä»£ç ï¼‰
set "RED=[91m"
set "GREEN=[92m"
set "YELLOW=[93m"
set "BLUE=[94m"
set "NC=[0m"  :: No Color

:: æ—¥å¿—å‡½æ•°
:log_info
    echo %BLUE%ğŸ” %~1%NC%
    exit /b 0

:log_success
    echo %GREEN%âœ… %~1%NC%
    exit /b 0

:log_warning
    echo %YELLOW%âš ï¸  %~1%NC%
    exit /b 0

:log_error
    echo %RED%âŒ %~1%NC%
    exit /b 0
```

**è®¾è®¡ç›®çš„**ï¼š

- ä½¿ç”¨é¢œè‰²å’Œè¡¨æƒ…ç¬¦å·å¢å¼ºæ—¥å¿—å¯è¯»æ€§ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿè¯†åˆ«ä¸åŒç±»å‹çš„ä¿¡æ¯
- ç»Ÿä¸€çš„æ—¥å¿—å‡½æ•°ä½¿è„šæœ¬è¾“å‡ºé£æ ¼ä¸€è‡´ï¼Œä¾¿äºç»´æŠ¤å’Œè°ƒè¯•
- å°½ç®¡è¯­æ³•ä¸åŒï¼Œå„å¹³å°å®ç°äº†ç›¸åŒçš„æ—¥å¿—è§†è§‰æ•ˆæœå’ŒåŠŸèƒ½

### 2.3 è·¯å¾„é…ç½®

#### 2.3.1 macOS å’Œ Linux è·¯å¾„é…ç½®

```bash
# Path Configuration
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BACKEND_ROOT="$(dirname "$SCRIPT_DIR")"
PROJECT_ROOT="$(dirname "$(dirname "$BACKEND_ROOT")")"

# Change to project root
cd "$PROJECT_ROOT" || { log_error "æ— æ³•åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•"; exit 1; }
```

#### 2.3.2 Windows è·¯å¾„é…ç½®

```batch
:: è·å–è„šæœ¬æ‰€åœ¨ç›®å½•å’Œé¡¹ç›®æ ¹ç›®å½•
set "SCRIPT_DIR=%~dp0"
set "SCRIPT_DIR=%SCRIPT_DIR:~0,-1%"  :: ç§»é™¤æœ«å°¾çš„åæ–œæ 
set "BACKEND_ROOT=%SCRIPT_DIR%\.."
set "PROJECT_ROOT=%BACKEND_ROOT%\.."

:: åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•
cd /d "%PROJECT_ROOT%" || (
    call :log_error "æ— æ³•åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•"
    pause
    exit /b 1
)
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨ macOS å’Œ Linux ä¸­ï¼Œä½¿ç”¨ `dirname` å’Œ `cd` ç»„åˆç¡®ä¿è·¯å¾„è®¡ç®—çš„å‡†ç¡®æ€§ï¼Œæ— è®ºè„šæœ¬ä»å“ªä¸ªç›®å½•è¢«è°ƒç”¨
- åœ¨ Windows ä¸­ï¼Œä½¿ç”¨ `%~dp0` è·å–è„šæœ¬ç›®å½•ï¼Œå¹¶ä½¿ç”¨ `cd /d` è¿›è¡Œè·¨é©±åŠ¨å™¨åˆ‡æ¢
- å„å¹³å°éƒ½å¼ºåˆ¶åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œåç»­æ“ä½œï¼Œç¡®ä¿ç›¸å¯¹è·¯å¾„å¼•ç”¨æ­£ç¡®
- ç›®å½•ç»“æ„éªŒè¯ç¡®ä¿è„šæœ¬åœ¨æ­£ç¡®çš„é¡¹ç›®ç¯å¢ƒä¸­æ‰§è¡Œ

## 3. Node.js ç¯å¢ƒç®¡ç†æœºåˆ¶

### 3.1 Node Version Manager å®‰è£…ä¸åŠ è½½

#### 3.1.1 macOS å’Œ Linux (nvm)

```bash
# æ£€æŸ¥å¹¶å®‰è£… nvm (Node Version Manager)
export NVM_DIR="$HOME/.nvm"
if [ ! -d "$NVM_DIR" ] || [ ! -f "$NVM_DIR/nvm.sh" ]; then
    log_info "æœªæ£€æµ‹åˆ° nvmï¼Œæ­£åœ¨å®‰è£…..."
    # ä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬å®‰è£… nvm
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash || {
        log_error "nvm å®‰è£…å¤±è´¥"
        # é”™è¯¯å¤„ç†...
    }

    # å®‰è£…å®ŒæˆååŠ è½½ nvm
    log_info "nvm å®‰è£…æˆåŠŸï¼Œæ­£åœ¨åŠ è½½..."
    # nvm åŠ è½½ä»£ç ...
else
    log_info "åŠ è½½å·²å®‰è£…çš„ nvm..."
    # nvm åŠ è½½ä»£ç ...
fi
```

#### 3.1.2 Windows (nvm-windows)

```batch
:: æ£€æŸ¥å¹¶å®‰è£… nvm-windows (Node Version Manager)
set "NVM_INSTALLED=false"
nvm --version >nul 2>&1
if %errorlevel% equ 0 (
    set "NVM_INSTALLED=true"
    call :log_success "nvm-windows å·²å®‰è£…"
) else (
    call :log_warning "æœªæ£€æµ‹åˆ° nvm-windowsï¼Œæ¨èå®‰è£…ï¼š"
    call :log_warning "1. ä¸‹è½½: https://github.com/coreybutler/nvm-windows/releases"
    call :log_warning "2. å®‰è£…åé‡å¯å‘½ä»¤æç¤ºç¬¦å¹¶é‡æ–°è¿è¡Œæ­¤è„šæœ¬"
    call :log_warning "æŒ‰ä»»æ„é”®ç»§ç»­ï¼ˆå¦‚å·²å®‰è£… Node.js 22.xï¼‰..."
    pause >nul
)
```

**è®¾è®¡ç›®çš„**ï¼š

- ä¸ºä¸åŒæ“ä½œç³»ç»Ÿæä¾›ç›¸åº”çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼šmacOS/Linux ä½¿ç”¨ nvmï¼ŒWindows ä½¿ç”¨ nvm-windows
- è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬ç®¡ç†å·¥å…·æ˜¯å¦å®‰è£…ï¼Œé¿å…é‡å¤å®‰è£…
- åœ¨ Windows ä¸Šæä¾›è¯¦ç»†çš„å®‰è£…æŒ‡å—ï¼Œå› ä¸ºéœ€è¦æ‰‹åŠ¨å®‰è£… nvm-windows
- å®‰è£…åç«‹å³åŠ è½½ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œä½¿åç»­çš„ Node.js ç‰ˆæœ¬ç®¡ç†æ“ä½œèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ

### 3.2 Node.js 22.x ç‰ˆæœ¬ä¸¥æ ¼æ§åˆ¶

#### 3.2.1 macOS å’Œ Linux Node.js ç‰ˆæœ¬æ§åˆ¶

```bash
# ä¸¥æ ¼æ£€æŸ¥å¹¶ä½¿ç”¨ Node.js 22.x
log_info "æ£€æŸ¥ Node.js 22.x ç‰ˆæœ¬..."

# å°è¯•ä½¿ç”¨ nvm åˆ‡æ¢åˆ° Node.js 22
if command -v nvm &> /dev/null; then
    if nvm ls 22 &> /dev/null; then
        log_info "å‘ç°å·²å®‰è£…çš„ Node.js 22.xï¼Œæ­£åœ¨åˆ‡æ¢..."
        nvm use 22 || {
            log_error "åˆ‡æ¢åˆ° Node.js 22.x å¤±è´¥"
            exit 1
        }
    else
        log_info "Node.js 22.x æœªå®‰è£…ï¼Œæ­£åœ¨é€šè¿‡ nvm å®‰è£…..."
        nvm install 22 || {
            log_error "é€šè¿‡ nvm å®‰è£… Node.js 22.x å¤±è´¥"
            exit 1
        }
        nvm use 22
    fi
else
    # å¦‚æœæ²¡æœ‰ nvmï¼Œæ£€æŸ¥ç³»ç»Ÿå®‰è£…çš„ Node.js ç‰ˆæœ¬
    # ç‰ˆæœ¬æ£€æŸ¥é€»è¾‘...
fi
```

#### 3.2.2 Windows Node.js ç‰ˆæœ¬æ§åˆ¶

```batch
:: æ£€æŸ¥ Node.js æ˜¯å¦å®‰è£…
node --version >nul 2>&1
if %errorlevel% neq 0 (
    call :log_error "Node.js æœªå®‰è£…"
    if "%NVM_INSTALLED%"=="true" (
        call :log_info "ä½¿ç”¨ nvm å®‰è£… Node.js 22.x..."
        nvm install 22
        if %errorlevel% neq 0 (
            call :log_error "é€šè¿‡ nvm å®‰è£… Node.js 22.x å¤±è´¥"
            pause
            exit /b 1
        )
        nvm use 22
        if %errorlevel% neq 0 (
            call :log_error "åˆ‡æ¢åˆ° Node.js 22.x å¤±è´¥"
            pause
            exit /b 1
        )
    ) else (
        call :log_error "è¯·å®‰è£… Node.js 22.x ç‰ˆæœ¬æˆ– nvm-windows"
        call :log_warning "ç›´æ¥ä¸‹è½½ Node.js 22.x: https://nodejs.org/en/download/"
        pause
        exit /b 1
    )
)

:: ä¸¥æ ¼æ£€æŸ¥ Node.js ç‰ˆæœ¬
for /f "tokens=*" %%i in ('node -v') do set NODE_VERSION=%%i

if "!NODE_VERSION:~0,4!"=="v22." (
    call :log_success "Node.js ç‰ˆæœ¬æ£€æŸ¥é€šè¿‡: !NODE_VERSION!"
) else (
    call :log_error "Node.js ç‰ˆæœ¬ä¸ç¬¦åˆè¦æ±‚: !NODE_VERSION!"
    call :log_warning "éœ€è¦ Node.js 22.x ç‰ˆæœ¬"

    if "%NVM_INSTALLED%"=="true" (
        call :log_info "å°è¯•é€šè¿‡ nvm å®‰è£… Node.js 22.x..."
        nvm install 22
        if %errorlevel% neq 0 (
            call :log_error "é€šè¿‡ nvm å®‰è£… Node.js 22.x å¤±è´¥"
            pause
            exit /b 1
        )
        nvm use 22
        if %errorlevel% neq 0 (
            call :log_error "åˆ‡æ¢åˆ° Node.js 22.x å¤±è´¥"
            pause
            exit /b 1
        )
    )
)
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨æ‰€æœ‰å¹³å°ä¸Šä¸¥æ ¼æ§åˆ¶ Node.js ç‰ˆæœ¬ä¸º 22.xï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§
- ä¼˜å…ˆä½¿ç”¨ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼ˆnvm æˆ– nvm-windowsï¼‰ç®¡ç† Node.js ç‰ˆæœ¬ï¼Œæä¾›æ›´å¥½çš„ç‰ˆæœ¬éš”ç¦»
- ä¸¥æ ¼æ£€æŸ¥ç‰ˆæœ¬å·ï¼Œç¡®ä¿ä½¿ç”¨çš„æ˜¯ 22.x ç³»åˆ—ç‰ˆæœ¬
- å¤šçº§é”™è¯¯å¤„ç†ç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§ï¼Œé˜²æ­¢å› ç‰ˆæœ¬ä¸åŒ¹é…å¯¼è‡´çš„å…¼å®¹æ€§é—®é¢˜
- åœ¨å„å¹³å°ä¸Šæä¾›æ˜ç¡®çš„é”™è¯¯æç¤ºå’Œå®‰è£…æŒ‡å—

### 3.3 pnpm åŒ…ç®¡ç†å™¨ç‰ˆæœ¬ç®¡ç†

#### 3.3.1 macOS å’Œ Linux pnpm ç‰ˆæœ¬æ§åˆ¶

```bash
# æ£€æŸ¥å¹¶å®‰è£… pnpm (ç‰ˆæœ¬ 8.15.0)
PNPM_REQUIRED_VERSION="8.15.0"
log_info "æ£€æŸ¥ pnpm å®‰è£…çŠ¶æ€..."

if command -v pnpm &> /dev/null; then
    PNPM_CURRENT_VERSION=$(pnpm -v)

    # æ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦åŒ¹é…
    if [[ "$PNPM_CURRENT_VERSION" == "$PNPM_REQUIRED_VERSION"* ]]; then
        log_success "pnpm å·²å®‰è£…ä¸”ç‰ˆæœ¬ç¬¦åˆè¦æ±‚: $PNPM_CURRENT_VERSION"
    else
        log_warning "pnpm ç‰ˆæœ¬ä¸åŒ¹é…: å·²å®‰è£… $PNPM_CURRENT_VERSIONï¼Œéœ€è¦ $PNPM_REQUIRED_VERSION"
        log_info "æ­£åœ¨æ›´æ–° pnpm..."
        npm install -g pnpm@$PNPM_REQUIRED_VERSION || {
            # å¤‡ç”¨å®‰è£…æ–¹æ³•...
        }
    fi
else
    # å®‰è£…é€»è¾‘...
fi
```

#### 3.3.2 Windows pnpm ç‰ˆæœ¬æ§åˆ¶

```batch
:: æ£€æŸ¥å¹¶å®‰è£… pnpm (ç‰ˆæœ¬ 8.15.0)
set "PNPM_REQUIRED_VERSION=8.15.0"
call :log_info "æ£€æŸ¥ pnpm å®‰è£…çŠ¶æ€..."

pnpm --version >nul 2>&1
if %errorlevel% equ 0 (
    for /f "tokens=*" %%i in ('pnpm --version') do set "PNPM_CURRENT_VERSION=%%i"

    :: æ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦åŒ¹é…
    if "!PNPM_CURRENT_VERSION:~0,6!"=="%PNPM_REQUIRED_VERSION%" (
        call :log_success "pnpm å·²å®‰è£…ä¸”ç‰ˆæœ¬ç¬¦åˆè¦æ±‚: !PNPM_CURRENT_VERSION!"
    ) else (
        call :log_warning "pnpm ç‰ˆæœ¬ä¸åŒ¹é…: å·²å®‰è£… !PNPM_CURRENT_VERSION!ï¼Œéœ€è¦ %PNPM_REQUIRED_VERSION%"
        call :log_info "æ­£åœ¨æ›´æ–° pnpm..."
        npm install -g pnpm@%PNPM_REQUIRED_VERSION%
        if %errorlevel% neq 0 (
            call :log_error "pnpm æ›´æ–°å¤±è´¥"
            pause
            exit /b 1
        )
        for /f "tokens=*" %%i in ('pnpm --version') do set "PNPM_CURRENT_VERSION=%%i"
        call :log_success "pnpm å·²æ›´æ–°åˆ°ç‰ˆæœ¬: !PNPM_CURRENT_VERSION!"
    )
) else (
    call :log_info "pnpm æœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…..."
    npm install -g pnpm@%PNPM_REQUIRED_VERSION%
    if %errorlevel% neq 0 (
        call :log_error "pnpm å®‰è£…å¤±è´¥"
        call :log_warning "è¯·æ‰‹åŠ¨å®‰è£… pnpm: https://pnpm.io/installation"
        pause
        exit /b 1
    )
    for /f "tokens=*" %%i in ('pnpm --version') do set "PNPM_CURRENT_VERSION=%%i"
    call :log_success "pnpm å·²å®‰è£…: !PNPM_CURRENT_VERSION!"
)
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨æ‰€æœ‰å¹³å°ä¸Šç²¾ç¡®æ§åˆ¶ pnpm ç‰ˆæœ¬ä¸º 8.15.0ï¼Œç¡®ä¿ä¸é¡¹ç›®ä¾èµ–å®Œå…¨å…¼å®¹
- æä¾›å¤šçº§å®‰è£…å’Œæ›´æ–°æœºåˆ¶ï¼Œå¢å¼ºè„šæœ¬çš„å¥å£®æ€§
- åœ¨å®‰è£…å¤±è´¥æ—¶æä¾›æ˜ç¡®çš„é”™è¯¯æç¤ºå’Œæ‰‹åŠ¨å®‰è£…æŒ‡å—
- æ‰€æœ‰è„šæœ¬åœ¨æˆåŠŸå®‰è£…åä¼šæ˜¾ç¤ºç¡®è®¤ä¿¡æ¯ï¼Œè®©ç”¨æˆ·äº†è§£å½“å‰å®‰è£…çš„ç‰ˆæœ¬

## 4. Docker ç¯å¢ƒé…ç½®

### 4.1 Docker å®‰è£…æ£€æµ‹

#### 4.1.1 macOS Docker å®‰è£…æ£€æµ‹

```bash
# æ£€æŸ¥å¹¶å®‰è£… Docker
if ! command -v docker &> /dev/null; then
    log_info "Docker æœªå®‰è£…ï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£…..."
    # ä½¿ç”¨ Homebrew å®‰è£… Docker Desktop
    # å®‰è£…é€»è¾‘...
    brew install --cask docker

    # å¯åŠ¨ Docker Desktop
    log_info "æ­£åœ¨å¯åŠ¨ Docker Desktop..."
    open -a Docker
fi
```

#### 4.1.2 Linux Docker å®‰è£…æ£€æµ‹

```bash
# æ£€æŸ¥å¹¶å®‰è£… Docker
if ! command -v docker &> /dev/null; then
    log_info "Docker æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Docker:"
    log_warning "Ubuntu/Debian ç³»ç»Ÿ: sudo apt-get install docker.io docker-compose"
    log_warning "CentOS/RHEL ç³»ç»Ÿ: sudo yum install docker docker-compose"
    log_warning "å®‰è£…å®Œæˆåè¯·ç¡®ä¿ç”¨æˆ·åŠ å…¥ docker ç»„å¹¶é‡å¯ä¼šè¯"
    exit 1
fi
```

#### 4.1.3 Windows Docker å®‰è£…æ£€æµ‹

```batch
:: æ£€æŸ¥ Docker æ˜¯å¦å®‰è£…
docker --version >nul 2>&1
if errorlevel 1 (
    call :log_error "Docker æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Docker Desktop for Windows"
    call :log_warning "ä¸‹è½½é“¾æ¥: https://docs.docker.com/desktop/install/windows-install/"
    call :log_warning "å®‰è£…å®Œæˆåè¯·é‡å¯è®¡ç®—æœºå¹¶é‡æ–°è¿è¡Œæ­¤è„šæœ¬"
    pause
    exit /b 1
)
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨æ‰€æœ‰å¹³å°ä¸Šè‡ªåŠ¨æ£€æµ‹ Docker å®‰è£…çŠ¶æ€ï¼Œæä¾›å¹³å°ç‰¹å®šçš„å®‰è£…æŒ‡å—
- åœ¨ macOS ä¸Šä½¿ç”¨ Homebrew è‡ªåŠ¨å®‰è£… Docker Desktopï¼Œç®€åŒ–å®‰è£…æµç¨‹
- åœ¨ Linux ä¸Šæä¾›é’ˆå¯¹ä¸åŒå‘è¡Œç‰ˆçš„å®‰è£…å‘½ä»¤ï¼Œé¿å…è‡ªåŠ¨å®‰è£…å¯èƒ½å¸¦æ¥çš„æƒé™é—®é¢˜
- åœ¨ Windows ä¸Šæä¾›ä¸‹è½½é“¾æ¥å’Œæ˜ç¡®çš„å®‰è£…åæ­¥éª¤ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿæ­£ç¡®å®‰è£… Docker Desktop
- å®‰è£…åè‡ªåŠ¨å¯åŠ¨ Docker æœåŠ¡æˆ–æä¾›å¯åŠ¨æŒ‡å—ï¼Œç®€åŒ–ç”¨æˆ·æ“ä½œ

### 4.2 Docker æœåŠ¡å¯åŠ¨ä¸ç­‰å¾…æœºåˆ¶

#### 4.2.1 macOS Docker æœåŠ¡å¯åŠ¨

```bash
# å¯åŠ¨ Docker æœåŠ¡ï¼ˆå¦‚æœæœªè¿è¡Œï¼‰
if ! docker info &> /dev/null; then
    log_info "å¯åŠ¨ Docker æœåŠ¡..."
    open -a Docker

    # ç­‰å¾… Docker å¯åŠ¨
    log_info "ç­‰å¾… Docker å¯åŠ¨..."
    for i in {1..30}; do
        if docker info &> /dev/null; then
            log_success "Docker æœåŠ¡å·²å¯åŠ¨"
            break
        fi
        # è¶…æ—¶å¤„ç†...
        sleep 2
    done
fi
```

#### 4.2.2 Linux Docker æœåŠ¡å¯åŠ¨

```bash
# å¯åŠ¨ Docker æœåŠ¡ï¼ˆå¦‚æœæœªè¿è¡Œï¼‰
if ! docker info &> /dev/null; then
    log_info "å¯åŠ¨ Docker æœåŠ¡..."
    sudo systemctl start docker || {
        log_error "æ— æ³•å¯åŠ¨ Docker æœåŠ¡ï¼Œè¯·æ£€æŸ¥ Docker æ˜¯å¦æ­£ç¡®å®‰è£…"
        log_warning "å¯èƒ½éœ€è¦ sudo æƒé™ï¼Œå°è¯•æ‰‹åŠ¨å¯åŠ¨: sudo systemctl start docker"
        exit 1
    }

    # ç­‰å¾… Docker å¯åŠ¨
    log_info "ç­‰å¾… Docker å¯åŠ¨..."
    for i in {1..10}; do
        if docker info &> /dev/null; then
            log_success "Docker æœåŠ¡å·²å¯åŠ¨"
            break
        fi
        sleep 2
    done
fi
```

#### 4.2.3 Windows Docker æœåŠ¡å¯åŠ¨

```batch
:: æ£€æŸ¥ Docker æœåŠ¡æ˜¯å¦è¿è¡Œ
docker info >nul 2>&1
if errorlevel 1 (
    call :log_warning "Docker Desktop æœªè¿è¡Œ"
    call :log_info "è¯·ç¡®ä¿ Docker Desktop æ­£åœ¨è¿è¡Œ"
    call :log_info "æ­£åœ¨ç­‰å¾… Docker å¯åŠ¨..."
    set /a "counter=0"
    :wait_docker
    set /a "counter+=1"
    if !counter! gtr 30 (
        call :log_error "Docker å¯åŠ¨è¶…æ—¶"
        call :log_warning "è¯·æ‰‹åŠ¨å¯åŠ¨ Docker Desktop å¹¶é‡æ–°è¿è¡Œæ­¤è„šæœ¬"
        pause
        exit /b 1
    )
    docker info >nul 2>&1
    if errorlevel 1 (
        timeout /t 5 /nobreak >nul
        goto wait_docker
    )
)

call :log_success "Docker æœåŠ¡å·²å¯åŠ¨"
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨æ‰€æœ‰å¹³å°ä¸Šå®ç°è½®è¯¢æœºåˆ¶æ£€æµ‹ Docker æœåŠ¡çŠ¶æ€ï¼Œé¿å…åœ¨ Docker æœªå®Œå…¨å¯åŠ¨æ—¶æ‰§è¡Œåç»­æ“ä½œ
- é’ˆå¯¹ä¸åŒå¹³å°æä¾›ç‰¹å®šçš„ Docker å¯åŠ¨æ–¹å¼ï¼šmacOS ä½¿ç”¨ open å‘½ä»¤ï¼ŒLinux ä½¿ç”¨ systemctlï¼ŒWindows ç­‰å¾…ç”¨æˆ·å¯åŠ¨
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢è„šæœ¬æ— é™ç­‰å¾…
- æä¾›æ˜ç¡®çš„çŠ¶æ€åé¦ˆå’Œé”™è¯¯å¤„ç†ï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒ

### 4.3 èµ„æºæ¸…ç†æœºåˆ¶

#### 4.3.1 macOS å’Œ Linux èµ„æºæ¸…ç†

```bash
# æ¸…ç†æ—§çš„ Docker èµ„æº
log_info "æ¸…ç†æ—§çš„ Docker èµ„æº..."
docker-compose down -v 2>/dev/null || true
docker volume prune -f 2>/dev/null || true
docker network prune -f 2>/dev/null || true
```

#### 4.3.2 Windows èµ„æºæ¸…ç†

```batch
:: æ¸…ç†æ—§çš„ Docker èµ„æº
call :log_info "æ¸…ç†æ—§çš„ Docker èµ„æº..."
docker-compose down -v 2>nul || (call :log_info "æ²¡æœ‰éœ€è¦æ¸…ç†çš„æ—§èµ„æº")
docker volume prune -f 2>nul || (call :log_info "æ— æ³•æ¸…ç†å·")
docker network prune -f 2>nul || (call :log_info "æ— æ³•æ¸…ç†ç½‘ç»œ")
```

**è®¾è®¡ç›®çš„**ï¼š

- æ¸…ç†æ—§çš„å®¹å™¨ã€å·å’Œç½‘ç»œï¼Œé¿å…èµ„æºå†²çª
- åœ¨ macOS å’Œ Linux ä¸Šä½¿ç”¨ `2>/dev/null || true` å¿½ç•¥é”™è¯¯
- åœ¨ Windows ä¸Šä½¿ç”¨ `2>nul || (call :log_info)` æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º
- ç¡®ä¿æ¯æ¬¡æ‰§è¡Œéƒ½æ˜¯åœ¨ä¸€ä¸ªå¹²å‡€çš„ç¯å¢ƒä¸­è¿›è¡Œï¼Œæé«˜ä¸€è‡´æ€§

## 5. æœåŠ¡é…ç½®ä¸å¯åŠ¨

### 5.1 ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶åˆ›å»º

#### 5.1.1 macOS å’Œ Linux ç¯å¢ƒå˜é‡é…ç½®

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
if [ ! -f "apps/backend/.env" ]; then
    log_info "åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶..."
    mkdir -p "$(dirname "apps/backend/.env")"
    cat > apps/backend/.env << EOF
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5433
DB_NAME=csisp
DB_USER=postgres
DB_PASSWORD=password
# å…¶ä»–é…ç½®...
EOF
    # åç»­æ“ä½œ...
else
    log_success "ç¯å¢ƒå˜é‡æ–‡ä»¶å·²å­˜åœ¨ (apps/backend/.env)"
fi
```

#### 5.1.2 Windows ç¯å¢ƒå˜é‡é…ç½®

```batch
:: åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
if not exist "apps\backend\.env" (
    call :log_info "åˆ›å»ºç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶..."
    if not exist "apps\backend" mkdir "apps\backend"
    (
        echo # æ•°æ®åº“é…ç½®
        echo DB_HOST=localhost
        echo DB_PORT=5433
        echo DB_NAME=csisp
        echo DB_USER=postgres
        echo DB_PASSWORD=password
        rem å…¶ä»–é…ç½®...
    ) > apps\backend\.env
    call :log_success "ç¯å¢ƒå˜é‡æ–‡ä»¶å·²åˆ›å»º (apps\backend\.env)"
    call :log_warning "è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ apps\backend\.env æ–‡ä»¶ä¸­çš„é…ç½®"
) else (
    call :log_success "ç¯å¢ƒå˜é‡æ–‡ä»¶å·²å­˜åœ¨ (apps\backend\.env)"
)
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨æ‰€æœ‰å¹³å°ä¸Šæä¾›æ ‡å‡†åŒ–çš„ç¯å¢ƒå˜é‡é…ç½®ï¼Œç¡®ä¿å¼€å‘ç¯å¢ƒä¸€è‡´æ€§
- åœ¨æ‰€æœ‰å¹³å°ä¸Šéƒ½åªåœ¨æ–‡ä»¶ä¸å­˜åœ¨æ—¶åˆ›å»ºï¼Œé¿å…è¦†ç›–ç”¨æˆ·è‡ªå®šä¹‰é…ç½®
- åœ¨å„å¹³å°ä¸Šä½¿ç”¨é€‚åˆå…¶è¯­æ³•çš„æ–‡ä»¶åˆ›å»ºæ–¹å¼ï¼ˆBash ä½¿ç”¨ Here Documentï¼ŒWindows ä½¿ç”¨é‡å®šå‘ï¼‰
- ç¡®ä¿æ•°æ®åº“ç«¯å£ç»Ÿä¸€é…ç½®ä¸º 5433ï¼Œé¿å…ä¸ç³»ç»Ÿä¸Šå¯èƒ½å·²å®‰è£…çš„ PostgreSQL æœåŠ¡å†²çª
- åˆ›å»ºå‰ç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨ï¼Œé¿å…å› ç›®å½•ä¸å­˜åœ¨å¯¼è‡´çš„åˆ›å»ºå¤±è´¥

### 5.2 Docker Compose é…ç½®

#### 5.2.1 macOS å’Œ Linux Docker Compose é…ç½®

```bash
# æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›å»º docker-compose.yml
if [ ! -f "docker-compose.yml" ]; then
    log_warning "æœªæ‰¾åˆ° docker-compose.yml æ–‡ä»¶ï¼Œæ­£åœ¨åˆ›å»º..."

    cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: csisp
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5433:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
EOF

    log_success "docker-compose.yml å·²åˆ›å»º"
else
    log_success "docker-compose.yml å·²å­˜åœ¨"
fi
```

#### 5.2.2 Windows Docker Compose é…ç½®

```batch
:: æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›å»º docker-compose.yml
if not exist "docker-compose.yml" (
    call :log_warning "æœªæ‰¾åˆ° docker-compose.yml æ–‡ä»¶ï¼Œæ­£åœ¨åˆ›å»º..."
    (
        echo version: '3.8'
        echo.
        echo services:
        echo   postgres:
        echo     image: postgres:15
        echo     environment:
        echo       POSTGRES_DB: csisp
        echo       POSTGRES_USER: postgres
        echo       POSTGRES_PASSWORD: password
        echo     ports:
        echo       - "5433:5432"
        echo     volumes:
        echo       - postgres_data:/var/lib/postgresql/data
        echo     healthcheck:
        echo       test: ["CMD-SHELL", "pg_isready -U postgres"]
        echo       interval: 30s
        echo       timeout: 10s
        echo       retries: 3
        echo     restart: unless-stopped
        echo.
        echo   redis:
        echo     image: redis:7-alpine
        echo     ports:
        echo       - "6379:6379"
        echo     volumes:
        echo       - redis_data:/data
        echo     healthcheck:
        echo       test: ["CMD", "redis-cli", "ping"]
        echo       interval: 30s
        echo       timeout: 10s
        echo       retries: 3
        echo     restart: unless-stopped
        echo.
        echo volumes:
        echo   postgres_data:
        echo   redis_data:
    ) > docker-compose.yml
    call :log_success "docker-compose.yml å·²åˆ›å»º"
) else (
    call :log_success "docker-compose.yml å·²å­˜åœ¨"
)
```

**è®¾è®¡ç›®çš„**ï¼š

- ç¡®ä¿æ‰€æœ‰å¹³å°ä¸Šéƒ½æœ‰å¿…è¦çš„æœåŠ¡é…ç½®æ–‡ä»¶
- åœ¨æ‰€æœ‰å¹³å°ä¸Šä¿æŒç›¸åŒçš„æœåŠ¡é…ç½®ï¼ŒåŒ…æ‹¬ PostgreSQL å’Œ Redis çš„é•œåƒã€ç¯å¢ƒå˜é‡ã€ç«¯å£æ˜ å°„ç­‰
- ç»Ÿä¸€å°† PostgreSQL çš„ç«¯å£æ˜ å°„è®¾ç½®ä¸º 5433:5432ï¼Œé¿å…ç«¯å£å†²çª
- ä½¿ç”¨é€‚å½“çš„è¯­æ³•ä¸ºå„å¹³å°åˆ›å»ºé…ç½®æ–‡ä»¶
- ä¸ºæ‰€æœ‰æœåŠ¡é…ç½®å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯ç­–ç•¥ï¼Œæé«˜æœåŠ¡çš„ç¨³å®šæ€§

### 5.3 æ•°æ®åº“æœåŠ¡å¯åŠ¨ä¸å¥åº·æ£€æŸ¥

### 5.3 æœåŠ¡å¯åŠ¨ä¸å¥åº·æ£€æŸ¥

#### 5.3.1 æ•°æ®åº“æœåŠ¡å¯åŠ¨ (macOS å’Œ Linux)

```bash
# ç¡®ä¿æ¸…é™¤æ—§çš„å®¹å™¨å’Œæ•°æ®å·ä»¥ä¿è¯å…¨æ–°å¯åŠ¨
docker-compose down -v postgres 2>/dev/null || true
log_info "å¯åŠ¨ PostgreSQL æ•°æ®åº“..."
docker-compose up -d postgres

# é”™è¯¯å¤„ç†...

# ç­‰å¾…æ•°æ®åº“æœåŠ¡å™¨å¯åŠ¨
log_info "ç­‰å¾…æ•°æ®åº“æœåŠ¡å™¨å¯åŠ¨..."
for i in {1..30}; do
    if docker-compose exec -T postgres pg_isready &> /dev/null; then
        log_success "æ•°æ®åº“æœåŠ¡å™¨å·²å¯åŠ¨"
        break
    fi
    # è¶…æ—¶å¤„ç†...
    sleep 2

done
```

#### 5.3.2 æ•°æ®åº“æœåŠ¡å¯åŠ¨ (Windows)

```batch
:: ç¡®ä¿æ¸…é™¤æ—§çš„å®¹å™¨å’Œæ•°æ®å·ä»¥ä¿è¯å…¨æ–°å¯åŠ¨
docker-compose down -v postgres 2>nul || (call :log_info "æ¸…ç†æ—§çš„ postgres æœåŠ¡")
call :log_info "å¯åŠ¨ PostgreSQL æ•°æ®åº“..."
docker-compose up -d postgres

:: é”™è¯¯å¤„ç†...

:: ç­‰å¾…æ•°æ®åº“æœåŠ¡å™¨å¯åŠ¨
call :log_info "ç­‰å¾…æ•°æ®åº“æœåŠ¡å™¨å¯åŠ¨..."
set /a counter=0
:wait_db
set /a counter+=1
if %counter% gtr 30 (
    call :log_error "æ•°æ®åº“æœåŠ¡å™¨å¯åŠ¨è¶…æ—¶"
    call :log_warning "è¯·æ£€æŸ¥ Docker å®¹å™¨æ—¥å¿—ä»¥è·å–æ›´å¤šä¿¡æ¯"
    pause
    exit /b 1
)
docker-compose exec -T postgres pg_isready >nul 2>&1
if errorlevel 1 (
    timeout /t 2 /nobreak >nul
    goto wait_db
)
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨å¯åŠ¨æœåŠ¡å‰å…ˆæ¸…ç†æ—§çš„å®¹å™¨å’Œæ•°æ®å·ï¼Œç¡®ä¿æ¯æ¬¡éƒ½æ˜¯å…¨æ–°å¯åŠ¨
- ä½¿ç”¨ `-d` å‚æ•°åœ¨åå°å¯åŠ¨æœåŠ¡ï¼Œæé«˜è„šæœ¬æ‰§è¡Œæ•ˆç‡
- å®ç°å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®åº“å®Œå…¨å°±ç»ªåå†æ‰§è¡Œåç»­æ“ä½œ
- è®¾ç½®è¶…æ—¶å¤„ç†ï¼Œé˜²æ­¢è„šæœ¬æ— é™ç­‰å¾…
- æä¾›æ˜ç¡®çš„å¯åŠ¨åé¦ˆå’Œé”™è¯¯å¤„ç†ï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒ
- æ‰€æœ‰å¹³å°ä¸Šçš„å¯åŠ¨é€»è¾‘ä¿æŒä¸€è‡´ï¼Œä½†ä½¿ç”¨å„è‡ªçš„è¯­æ³•ç‰¹æ€§

## 6. æ•°æ®åº“åˆå§‹åŒ–æµç¨‹

### 6.1 æ•°æ®åº“ç”¨æˆ·ä¸æ•°æ®åº“åˆ›å»º

#### 6.1.1 macOS å’Œ Linux æ•°æ®åº“åˆå§‹åŒ–

```bash
# åˆ›å»ºæ•°æ®åº“ç”¨æˆ·å’Œæ•°æ®åº“
log_info "åˆ›å»ºæ•°æ®åº“ç”¨æˆ·..."
docker-compose exec -T postgres psql -U postgres -c "CREATE USER admin WITH PASSWORD 'password' CREATEDB;" 2>/dev/null || log_info "adminç”¨æˆ·å·²å­˜åœ¨æˆ–åˆ›å»ºå¤±è´¥"
log_info "æˆäºˆadminç”¨æˆ·æƒé™..."
docker-compose exec -T postgres psql -U postgres -c "GRANT ALL PRIVILEGES ON DATABASE csisp TO admin;" 2>/dev/null || log_info "æƒé™å·²æˆäºˆæˆ–æˆäºˆå¤±è´¥"
docker-compose exec -T postgres psql -U postgres -d csisp -c "GRANT ALL ON SCHEMA public TO admin;" 2>/dev/null || log_info "Schemaæƒé™å·²æˆäºˆæˆ–æˆäºˆå¤±è´¥"
log_info "åˆ›å»ºæ•°æ®åº“..."
docker-compose exec -T postgres psql -U postgres -c "CREATE DATABASE csisp OWNER admin;" 2>/dev/null || log_info "æ•°æ®åº“å·²å­˜åœ¨æˆ–åˆ›å»ºå¤±è´¥"
```

#### 6.1.2 Windows æ•°æ®åº“åˆå§‹åŒ–

```batch
:: åˆ›å»ºæ•°æ®åº“ç”¨æˆ·å’Œæ•°æ®åº“
call :log_info "åˆ›å»ºæ•°æ®åº“ç”¨æˆ·..."
docker-compose exec -T postgres psql -U postgres -c "CREATE USER admin WITH PASSWORD 'password' CREATEDB;" 2>nul || (call :log_info "adminç”¨æˆ·å·²å­˜åœ¨æˆ–åˆ›å»ºå¤±è´¥")
call :log_info "æˆäºˆadminç”¨æˆ·æƒé™..."
docker-compose exec -T postgres psql -U postgres -c "GRANT ALL PRIVILEGES ON DATABASE csisp TO admin;" 2>nul || (call :log_info "æƒé™å·²æˆäºˆæˆ–æˆäºˆå¤±è´¥")
docker-compose exec -T postgres psql -U postgres -d csisp -c "GRANT ALL ON SCHEMA public TO admin;" 2>nul || (call :log_info "Schemaæƒé™å·²æˆäºˆæˆ–æˆäºˆå¤±è´¥")
call :log_info "åˆ›å»ºæ•°æ®åº“..."
docker-compose exec -T postgres psql -U postgres -c "CREATE DATABASE csisp OWNER admin;" 2>nul || (call :log_info "æ•°æ®åº“å·²å­˜åœ¨æˆ–åˆ›å»ºå¤±è´¥")
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨æ‰€æœ‰å¹³å°ä¸Šåˆ›å»ºæ ‡å‡†åŒ–çš„æ•°æ®åº“ç”¨æˆ·å’Œæ•°æ®åº“ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºè¿æ¥æ­£å¸¸
- åœ¨æ‰€æœ‰å¹³å°ä¸Šæ‰§è¡Œç›¸åŒçš„æƒé™è®¾ç½®æ­¥éª¤ï¼ŒåŒ…æ‹¬æ•°æ®åº“çº§å’Œæ¨¡å¼çº§æƒé™
- ä½¿ç”¨é”™è¯¯å¿½ç•¥æœºåˆ¶å¤„ç†é‡å¤åˆ›å»ºçš„æƒ…å†µï¼Œæé«˜è„šæœ¬çš„å¯é‡å¤æ‰§è¡Œæ€§
- æä¾›æ¸…æ™°çš„æ‰§è¡Œæ­¥éª¤åé¦ˆï¼Œæ–¹ä¾¿ç”¨æˆ·äº†è§£å½“å‰è¿›åº¦å’Œå¯èƒ½çš„é—®é¢˜

### 6.2 æ•°æ®åº“è¿ç§»æ‰§è¡Œ

#### 6.2.1 macOS å’Œ Linux æ•°æ®åº“è¿ç§»

```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»
log_info "è¿è¡Œæ•°æ®åº“è¿ç§»..."
(cd apps/backend && pnpm exec sequelize-cli db:migrate)

if [ $? -ne 0 ]; then
    log_error "æ•°æ®åº“è¿ç§»å¤±è´¥"
    log_warning "è¯·æ£€æŸ¥è¿ç§»æ–‡ä»¶å’Œæ•°æ®åº“è¿æ¥é…ç½®"
    exit 1
fi

log_success "æ•°æ®åº“è¿ç§»å®Œæˆ"
```

#### 6.2.2 Windows æ•°æ®åº“è¿ç§»

```batch
:: è¿è¡Œæ•°æ®åº“è¿ç§»
call :log_info "è¿è¡Œæ•°æ®åº“è¿ç§»..."
cd /d "apps\backend"
pnpm exec sequelize-cli db:migrate
cd /d "%PROJECT_ROOT%"

if errorlevel 1 (
    call :log_error "æ•°æ®åº“è¿ç§»å¤±è´¥"
    call :log_warning "è¯·æ£€æŸ¥è¿ç§»æ–‡ä»¶å’Œæ•°æ®åº“è¿æ¥é…ç½®"
    pause
    exit /b 1
)

call :log_success "æ•°æ®åº“è¿ç§»å®Œæˆ"
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨æ­£ç¡®çš„ç›®å½•ä¸­æ‰§è¡Œè¿ç§»å‘½ä»¤ï¼Œç¡®ä¿ç›¸å¯¹è·¯å¾„å¼•ç”¨æ­£ç¡®
- åœ¨ macOS å’Œ Linux ä¸Šä½¿ç”¨å­ shell æ‰§è¡Œï¼Œåœ¨ Windows ä¸Šä½¿ç”¨ cd å‘½ä»¤åˆ‡æ¢ç›®å½•
- ä¸¥æ ¼æ£€æŸ¥è¿ç§»ç»“æœï¼Œç¡®ä¿æ•°æ®åº“ç»“æ„æ­£ç¡®åˆ›å»º
- æä¾›æ˜ç¡®çš„é”™è¯¯æç¤ºå’Œæ¢å¤å»ºè®®
- åœ¨ Windows ä¸Šæ·»åŠ  pause å‘½ä»¤ï¼Œè®©ç”¨æˆ·æœ‰æ—¶é—´æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

## 7. é¡¹ç›®ç›®å½•ä¸æƒé™é…ç½®

### 7.1 å¿…è¦ç›®å½•åˆ›å»º

#### 7.1.1 macOS å’Œ Linux ç›®å½•åˆ›å»ºä¸æƒé™è®¾ç½®

```bash
# åˆ›å»ºå¿…è¦çš„ç›®å½•
log_info "åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„..."
mkdir -p apps/backend/logs apps/backend/uploads/temp apps/backend/uploads/homework

# è®¾ç½®ç›®å½•æƒé™
chmod 755 apps/backend/uploads apps/backend/uploads/temp apps/backend/uploads/homework apps/backend/logs
```

#### 7.1.2 Windows ç›®å½•åˆ›å»º

```batch
:: åˆ›å»ºå¿…è¦çš„ç›®å½•
call :log_info "åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„..."
if not exist "apps\backend\logs" mkdir apps\backend\logs
if not exist "apps\backend\uploads" mkdir apps\backend\uploads
if not exist "apps\backend\uploads\temp" mkdir apps\backend\uploads\temp
if not exist "apps\backend\uploads\homework" mkdir apps\backend\uploads\homework
```

**è®¾è®¡ç›®çš„**ï¼š

- æå‰åˆ›å»ºåº”ç”¨ç¨‹åºè¿è¡Œæ‰€éœ€çš„ç›®å½•ï¼Œé¿å…è¿è¡Œæ—¶å› ç›®å½•ä¸å­˜åœ¨å¯¼è‡´çš„é”™è¯¯
- åœ¨ macOS å’Œ Linux ä¸Šä½¿ç”¨ `mkdir -p` ç¡®ä¿çˆ¶ç›®å½•ä¸å­˜åœ¨æ—¶ä¹Ÿèƒ½æˆåŠŸåˆ›å»ºï¼Œå¹¶è®¾ç½®é€‚å½“çš„ç›®å½•æƒé™
- åœ¨ Windows ä¸Šä½¿ç”¨å•ç‹¬çš„ if not exist æ£€æŸ¥å’Œ mkdir å‘½ä»¤åˆ›å»ºç›®å½•
- æ‰€æœ‰å¹³å°ä¸Šåˆ›å»ºç›¸åŒçš„ç›®å½•ç»“æ„ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºåœ¨ä¸åŒç¯å¢ƒä¸­éƒ½èƒ½æ­£å¸¸è¿è¡Œ

## 8. ç§å­æ•°æ®åˆå§‹åŒ–

### 8.1 ç§å­æ•°æ®åˆå§‹åŒ–

#### 8.1.1 macOS å’Œ Linux ç§å­æ•°æ®åˆå§‹åŒ–

```bash
# æ£€æŸ¥seed_data.jsæ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "apps/backend/scripts/seed_data.js" ]; then
    log_error "æœªæ‰¾åˆ°ç§å­æ•°æ®è„šæœ¬ (apps/backend/scripts/seed_data.js)"
    exit 1
fi

# è¿è¡Œç§å­æ•°æ®è„šæœ¬
log_info "ç”Ÿæˆç§å­æ•°æ®..."
(cd apps/backend && node scripts/seed_data.js)

if [ $? -ne 0 ]; then
    log_error "ç§å­æ•°æ®ç”Ÿæˆå¤±è´¥"
    log_warning "è¯·æ£€æŸ¥seed_data.jsè„šæœ¬å†…å®¹å’Œæ•°æ®åº“è¿æ¥"
    exit 1
fi

log_success "ç§å­æ•°æ®ç”Ÿæˆå®Œæˆ"
```

#### 8.1.2 Windows ç§å­æ•°æ®åˆå§‹åŒ–

```batch
:: æ£€æŸ¥seed_data.jsæ–‡ä»¶æ˜¯å¦å­˜åœ¨
if not exist "apps\backend\scripts\seed_data.js" (
    call :log_error "æœªæ‰¾åˆ°ç§å­æ•°æ®è„šæœ¬ (apps\backend\scripts\seed_data.js)"
    pause
    exit /b 1
)

:: è¿è¡Œç§å­æ•°æ®è„šæœ¬
call :log_info "ç”Ÿæˆç§å­æ•°æ®..."
cd /d "apps\backend"
node scripts\seed_data.js
cd /d "%PROJECT_ROOT%"

if errorlevel 1 (
    call :log_error "ç§å­æ•°æ®ç”Ÿæˆå¤±è´¥"
    call :log_warning "è¯·æ£€æŸ¥seed_data.jsè„šæœ¬å†…å®¹å’Œæ•°æ®åº“è¿æ¥"
    pause
    exit /b 1
)

call :log_success "ç§å­æ•°æ®ç”Ÿæˆå®Œæˆ"
```

**è®¾è®¡ç›®çš„**ï¼š

- åœ¨æ‰§è¡Œå‰éªŒè¯ç§å­æ•°æ®è„šæœ¬çš„å­˜åœ¨æ€§ï¼Œé¿å…æ‰§è¡Œä¸å­˜åœ¨çš„è„šæœ¬
- åœ¨æ­£ç¡®çš„ç›®å½•ä¸­æ‰§è¡Œç§å­æ•°æ®ç”Ÿæˆï¼Œç¡®ä¿è·¯å¾„å¼•ç”¨æ­£ç¡®
- ä¸¥æ ¼æ£€æŸ¥æ‰§è¡Œç»“æœï¼Œç¡®ä¿æµ‹è¯•æ•°æ®æˆåŠŸæ’å…¥
- æä¾›æ˜ç¡®çš„é”™è¯¯æç¤ºå’Œæ¢å¤å»ºè®®
- åœ¨ Windows ä¸Šæ·»åŠ  pause å‘½ä»¤ï¼Œè®©ç”¨æˆ·æœ‰æ—¶é—´æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

## 9. æ‰§è¡Œç»“æœå±•ç¤ºä¸ç”¨æˆ·åé¦ˆ

### 9.1 æ‰§è¡Œç»“æœå±•ç¤ºä¸ç”¨æˆ·åé¦ˆ

#### 9.1.1 macOS å’Œ Linux æ‰§è¡Œç»“æœå±•ç¤º

```bash
# æ˜¾ç¤ºæœåŠ¡çŠ¶æ€
log_info "\nğŸ“Š æœåŠ¡çŠ¶æ€æ£€æŸ¥:"
POSTGRES_STATUS=$(docker-compose ps postgres | grep -o 'Up' || echo 'Down')
REDIS_STATUS=$(docker-compose ps redis | grep -o 'Up' || echo 'Down')

# çŠ¶æ€è¾“å‡º...

# æ˜¾ç¤ºåˆå§‹åŒ–å®Œæˆä¿¡æ¯
echo -e "\n${GREEN}ğŸ‰ CSISP åç«¯ç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼${NC}"
echo -e "\n${GREEN}âœ… å·²å®Œæˆçš„ä»»åŠ¡:${NC}"
# ä»»åŠ¡åˆ—è¡¨...

# å¸¸ç”¨å‘½ä»¤æç¤º...
```

#### 9.1.2 Windows æ‰§è¡Œç»“æœå±•ç¤º

```batch
:: æ˜¾ç¤ºæœåŠ¡çŠ¶æ€
call :log_info "
ğŸ“Š æœåŠ¡çŠ¶æ€æ£€æŸ¥:"
set "POSTGRES_STATUS=Down"
set "REDIS_STATUS=Down"

docker-compose ps postgres | findstr "Up" >nul
if %errorlevel% equ 0 (
    set "POSTGRES_STATUS=Up"
)

docker-compose ps redis | findstr "Up" >nul
if %errorlevel% equ 0 (
    set "REDIS_STATUS=Up"
)

if "%POSTGRES_STATUS%" == "Up" (
    echo    PostgreSQL: %GREEN%Up%NC%
) else (
    echo    PostgreSQL: %RED%Down%NC%
)

if "%REDIS_STATUS%" == "Up" (
    echo    Redis: %GREEN%Up%NC%
) else (
    echo    Redis: %RED%Down%NC%
)

:: æ˜¾ç¤ºåˆå§‹åŒ–å®Œæˆä¿¡æ¯
echo.
echo %GREEN%ğŸ‰ CSISP åç«¯ç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼%NC%
echo.
echo %GREEN%âœ… å·²å®Œæˆçš„ä»»åŠ¡:%NC%
:: ä»»åŠ¡åˆ—è¡¨...

:: å¸¸ç”¨å‘½ä»¤æç¤º...
```

**è®¾è®¡ç›®çš„**ï¼š

- æä¾›æ¸…æ™°çš„æœåŠ¡çŠ¶æ€æ¦‚è§ˆï¼Œå¸®åŠ©ç”¨æˆ·ç¡®è®¤ç¯å¢ƒé…ç½®æˆåŠŸ
- ä½¿ç”¨é¢œè‰²é«˜äº®æ˜¾ç¤ºæœåŠ¡çŠ¶æ€ï¼Œä½¿ä¿¡æ¯ä¸€ç›®äº†ç„¶
- æ€»ç»“å·²å®Œæˆçš„ä»»åŠ¡ï¼Œå¢å¼ºç”¨æˆ·çš„æˆå°±æ„Ÿå’Œå¯¹æ‰§è¡Œè¿‡ç¨‹çš„äº†è§£
- æä¾›å¸¸ç”¨å‘½ä»¤æç¤ºï¼Œæ–¹ä¾¿ç”¨æˆ·åç»­æ“ä½œ
- åœ¨ Windows ä¸Šä½¿ç”¨é€‚åˆå…¶å‘½ä»¤æç¤ºç¬¦çš„é¢œè‰²å’Œæ ¼å¼åŒ–æ–¹å¼

## 10. æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ

### 10.1 æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ

æ‰€æœ‰æ“ä½œç³»ç»Ÿç‰ˆæœ¬çš„è„šæœ¬ç»“å°¾éƒ½æä¾›äº†é‡è¦çš„æ³¨æ„äº‹é¡¹ï¼Œå†…å®¹åŸºæœ¬ç›¸åŒï¼š

```bash
# macOS/Linux ç‰ˆæœ¬
echo -e "\n${YELLOW}â„¹ï¸  æ³¨æ„äº‹é¡¹:${NC}"
echo "   â€¢ è¯·ç¡®ä¿.envæ–‡ä»¶ä¸­çš„JWTå¯†é’¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹ä¸ºå®‰å…¨çš„å€¼"
echo "   â€¢ å®šæœŸå¤‡ä»½æ•°æ®åº“ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±"
echo "   â€¢ å¦‚é‡åˆ°ç«¯å£å†²çªï¼Œè¯·ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„"

# Windows ç‰ˆæœ¬
echo.
echo %YELLOW%â„¹ï¸  æ³¨æ„äº‹é¡¹:%NC%
echo    â€¢ è¯·ç¡®ä¿.envæ–‡ä»¶ä¸­çš„JWTå¯†é’¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹ä¸ºå®‰å…¨çš„å€¼
echo    â€¢ å®šæœŸå¤‡ä»½æ•°æ®åº“ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±
echo    â€¢ å¦‚é‡åˆ°ç«¯å£å†²çªï¼Œè¯·ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„
```

**è®¾è®¡ç›®çš„**ï¼š

- æé†’ç”¨æˆ·æ³¨æ„å®‰å…¨é…ç½®ï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­
- æä¾›åç»­ç»´æŠ¤çš„æœ€ä½³å®è·µå»ºè®®
- é¢„è§å¯èƒ½å‡ºç°çš„é—®é¢˜å¹¶æä¾›è§£å†³æ–¹æ¡ˆï¼Œé™ä½ç”¨æˆ·é‡åˆ°é—®é¢˜æ—¶çš„å›°æ‰°
- å°½ç®¡è¯­æ³•ä¸åŒï¼Œä½†æ‰€æœ‰å¹³å°ä¸Šéƒ½æ˜¾ç¤ºç›¸åŒçš„å…³é”®ä¿¡æ¯

## 11. seed_data.js æ•°æ®ç”Ÿæˆé€»è¾‘

`seed_data.js` æ˜¯ä¸€ä¸ªNode.jsè„šæœ¬ï¼Œè´Ÿè´£ç”Ÿæˆç³»ç»Ÿæ‰€éœ€çš„åˆå§‹åŒ–æ•°æ®ï¼Œè¯¥è„šæœ¬é€šè¿‡Sequelize ORMæ¡†æ¶ä¸PostgreSQLæ•°æ®åº“äº¤äº’ï¼Œç”ŸæˆåŒ…å«è§’è‰²ã€ç”¨æˆ·ã€è¯¾ç¨‹ã€æ•™å¸ˆç­‰åœ¨å†…çš„å®Œæ•´æµ‹è¯•æ•°æ®é›†ã€‚ä¸‹é¢æ˜¯è¯¥è„šæœ¬çš„æ ¸å¿ƒå®ç°é€»è¾‘ï¼š

### 11.1 æ•°æ®æ¨¡å‹å®šä¹‰

è„šæœ¬é¦–å…ˆå®šä¹‰äº†ç³»ç»Ÿæ‰€éœ€çš„11ä¸ªæ ¸å¿ƒæ•°æ®æ¨¡å‹åŠå…¶å…³è”å…³ç³»ï¼š

```javascript
// ç”¨æˆ·æ¨¡å‹
const User = sequelize.define('User', {
  id: { type: DataTypes.INTEGER, primaryKey: true, autoIncrement: true },
  username: { type: DataTypes.STRING(255), allowNull: false, unique: true },
  password: { type: DataTypes.STRING(255), allowNull: false },
  real_name: { type: DataTypes.STRING(255), allowNull: false },
  student_id: { type: DataTypes.STRING(11), allowNull: false, unique: true },
  enrollment_year: {
    type: DataTypes.INTEGER,
    allowNull: false,
    validate: { min: 2022, max: 2025 },
  },
  major: { type: DataTypes.STRING(100), allowNull: false },
  status: { type: DataTypes.INTEGER, defaultValue: 1 },
});

// è§’è‰²æ¨¡å‹
const Role = sequelize.define('Role', {
  id: { type: DataTypes.INTEGER, primaryKey: true, autoIncrement: true },
  name: { type: DataTypes.STRING(50), allowNull: false, unique: true },
  description: { type: DataTypes.STRING(255), allowNull: false },
});

// è¯¾ç¨‹æ¨¡å‹
const Course = sequelize.define('Course', {
  id: { type: DataTypes.INTEGER, primaryKey: true, autoIncrement: true },
  course_name: { type: DataTypes.STRING(255), allowNull: false },
  course_code: { type: DataTypes.STRING(50), allowNull: false },
  semester: { type: DataTypes.INTEGER, allowNull: false, validate: { min: 1, max: 8 } },
  academic_year: { type: DataTypes.INTEGER, allowNull: false },
  available_majors: { type: DataTypes.JSON, allowNull: false },
  status: { type: DataTypes.INTEGER, defaultValue: 1 },
});

// å…¶ä»–æ¨¡å‹åŒ…æ‹¬ï¼šTeacher, Class, TimeSlot, AttendanceTask, AttendanceRecordä»¥åŠå…³è”è¡¨
```

### 11.2 é¢„è®¾æ•°æ®å®šä¹‰

è„šæœ¬å®šä¹‰äº†å¤§é‡é¢„è®¾æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š

- **è¯¾ç¨‹æ•°æ®(`COURSE_DATA`)**: åŒ…å«100+é—¨è®¡ç®—æœºç›¸å…³ä¸“ä¸šè¯¾ç¨‹ï¼Œæ¶µç›–1-8å­¦æœŸçš„å¿…ä¿®è¯¾ã€é€‰ä¿®è¯¾å’Œä¸“ä¸šè¯¾ç¨‹
- **æ•™å¸ˆæ•°æ®(`TEACHERS`)**: é¢„å®šä¹‰äº†22ä½æ¥è‡ªä¸åŒé™¢ç³»çš„æ•™å¸ˆä¿¡æ¯

### 11.3 æ•°æ®ç”Ÿæˆæ ¸å¿ƒé€»è¾‘

æ•°æ®ç”Ÿæˆè¿‡ç¨‹åœ¨`generateSeedData`å‡½æ•°ä¸­å®ç°ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

```javascript
async function generateSeedData() {
  try {
    console.log('ğŸš€ å¼€å§‹ç”ŸæˆCSISPç§å­æ•°æ®...');

    // è¿æ¥åˆ°æ•°æ®åº“å¹¶åŒæ­¥æ¨¡å‹
    await sequelize.authenticate();
    await sequelize.sync({ force: false });

    // 1. åˆ›å»ºè§’è‰²æ•°æ®
    const roleData = [
      { name: 'admin', description: 'ç®¡ç†å‘˜è§’è‰²' },
      { name: 'student', description: 'å­¦ç”Ÿè§’è‰²' },
      { name: 'course_rep', description: 'è¯¾ä»£è¡¨è§’è‰²' },
      { name: 'student_cadre', description: 'å­¦ç”Ÿå¹²éƒ¨è§’è‰²' },
    ];
    // ä½¿ç”¨findOrCreateé¿å…é‡å¤æ’å…¥
    const roles = [];
    for (const roleItem of roleData) {
      const [role, created] = await Role.findOrCreate({
        where: { name: roleItem.name },
        defaults: roleItem,
      });
      roles.push(role);
    }

    // 2. åˆ›å»ºæ•™å¸ˆæ•°æ®
    const teacherData = [
      /* æ•™å¸ˆä¿¡æ¯åˆ—è¡¨ */
    ];
    // æ’å…¥æ•™å¸ˆæ•°æ®çš„é€»è¾‘...

    // 3. åˆ›å»ºå­¦ç”Ÿæ•°æ® (800+åå­¦ç”Ÿ)
    const enrollmentYears = [2022, 2023, 2024, 2025];
    const createdStudents = [];
    let successCount = 0;

    // ä¸“ä¸šä»£ç æ˜ å°„
    const MAJOR_CODES = {
      è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯: '2131',
      'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ï¼ˆå¸ˆèŒƒï¼‰': '2121',
      ç½‘ç»œå·¥ç¨‹: '2132',
    };

    // å¾ªç¯ç”Ÿæˆå„å¹´çº§ã€å„ä¸“ä¸šçš„å­¦ç”Ÿ
    for (const year of enrollmentYears) {
      const majorDistribution = [
        { major: 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯', count: 120 },
        { major: 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ï¼ˆå¸ˆèŒƒï¼‰', count: 40 },
        { major: 'ç½‘ç»œå·¥ç¨‹', count: 40 },
      ];

      for (const { major, count } of majorDistribution) {
        for (let i = 1; i <= count; i++) {
          // ç”Ÿæˆ11ä½å­¦å·ï¼šå…¥å­¦å¹´ä»½ + ä¸“ä¸šä»£ç  + ä¸‰ä½åºå·
          const majorCode = MAJOR_CODES[major];
          const sequenceNumber = String(i).padStart(3, '0');
          const studentId = `${year}${majorCode}${sequenceNumber}`;
          const name = generateChineseName(); // éšæœºç”Ÿæˆä¸­æ–‡å
          const username = `student${year}${major.substring(0, 2)}${String(i).padStart(3, '0')}`;

          // ä½¿ç”¨findOrCreateé¿å…é‡å¤æ’å…¥
          const [student, created] = await User.findOrCreate({
            where: { [Sequelize.Op.or]: [{ username }, { student_id: studentId }] },
            defaults: {
              username,
              password: await bcrypt.hash('password123', 12), // å¯†ç åŠ å¯†å­˜å‚¨
              real_name: name,
              student_id: studentId,
              enrollment_year: year,
              major,
            },
          });
        }
      }
    }

    // 4. ä¸ºå­¦ç”Ÿåˆ†é…è§’è‰²
    // 5. åˆ›å»ºè¯¾ç¨‹æ•°æ®
    // 6. åˆ†é…æ•™å¸ˆåˆ°è¯¾ç¨‹
    // 7. åˆ›å»ºç­çº§å’Œæ—¶é—´å®‰æ’
    // 8. ç”Ÿæˆè€ƒå‹¤ä»»åŠ¡å’Œè®°å½•
  } catch (error) {
    console.error('ç”Ÿæˆç§å­æ•°æ®æ—¶å‡ºé”™:', error);
  }
}
```

### 11.4 å…³é”®å®ç°ç‰¹ç‚¹

1. **æ™ºèƒ½IDç”Ÿæˆ**: å­¦å·æŒ‰ç…§ç‰¹å®šè§„åˆ™ç”Ÿæˆï¼Œæ ¼å¼ä¸º`å…¥å­¦å¹´ä»½+ä¸“ä¸šä»£ç +åºå·`

   ```javascript
   const studentId = `${year}${majorCode}${sequenceNumber}`; // å¦‚ï¼š20232131001
   ```

2. **å®‰å…¨æ€§è€ƒè™‘**: ç”¨æˆ·å¯†ç ä½¿ç”¨bcryptè¿›è¡Œå“ˆå¸ŒåŠ å¯†å­˜å‚¨

   ```javascript
   password: await bcrypt.hash('password123', 12);
   ```

3. **æ•°æ®å”¯ä¸€æ€§ä¿éšœ**: ä½¿ç”¨`findOrCreate`æ–¹æ³•ç¡®ä¿ä¸ä¼šåˆ›å»ºé‡å¤æ•°æ®

   ```javascript
   const [student, created] = await User.findOrCreate({
     where: { [Sequelize.Op.or]: [{ username }, { student_id: studentId }] },
     defaults: {
       /* ç”¨æˆ·ä¿¡æ¯ */
     },
   });
   ```

4. **æ•°æ®å®Œæ•´æ€§éªŒè¯**: é€šè¿‡Sequelizeçš„éªŒè¯è§„åˆ™ç¡®ä¿æ•°æ®æœ‰æ•ˆæ€§

   ```javascript
   enrollment_year: { type: DataTypes.INTEGER, allowNull: false, validate: { min: 2022, max: 2025 } }
   ```

5. **é”™è¯¯å¤„ç†æœºåˆ¶**: æ•´ä¸ªæ•°æ®ç”Ÿæˆè¿‡ç¨‹åŒ…å«å®Œæ•´çš„é”™è¯¯æ•è·å’Œæ—¥å¿—è®°å½•

### 11.5 æ•°æ®è§„æ¨¡ä¸åˆ†å¸ƒ

- **å­¦ç”Ÿæ•°æ®**: ç”Ÿæˆ800+åå­¦ç”Ÿï¼Œåˆ†å¸ƒåœ¨2022-2025å››ä¸ªå¹´çº§
- **ä¸“ä¸šåˆ†å¸ƒ**: è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯(120/å¹´çº§)ã€è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ï¼ˆå¸ˆèŒƒï¼‰(40/å¹´çº§)ã€ç½‘ç»œå·¥ç¨‹(40/å¹´çº§)
- **è¯¾ç¨‹æ•°æ®**: 100+é—¨è¯¾ç¨‹ï¼ŒæŒ‰1-8å­¦æœŸç»„ç»‡ï¼Œæ”¯æŒä¸åŒä¸“ä¸šçš„é€‰è¯¾éœ€æ±‚
- **æ•™å¸ˆèµ„æº**: 22ä½æ•™å¸ˆåˆ†å¸ƒåœ¨ä¸‰ä¸ªé™¢ç³»ï¼Œè´Ÿè´£ä¸åŒè¯¾ç¨‹çš„æ•™å­¦

### 11.6 æ‰§è¡Œæµç¨‹ä¸æ•°æ®å…³è”

1. é¦–å…ˆè¿æ¥æ•°æ®åº“å¹¶åŒæ­¥æ¨¡å‹ç»“æ„
2. æŒ‰é¡ºåºåˆ›å»ºåŸºç¡€æ•°æ®ï¼ˆè§’è‰²ã€æ•™å¸ˆï¼‰
3. æ‰¹é‡ç”Ÿæˆå­¦ç”Ÿæ•°æ®
4. ä¸ºå­¦ç”Ÿåˆ†é…è§’è‰²æƒé™
5. åˆ›å»ºè¯¾ç¨‹å¹¶å…³è”æ•™å¸ˆ
6. ç”Ÿæˆç­çº§å’Œä¸Šè¯¾æ—¶é—´å®‰æ’
7. åˆ›å»ºè€ƒå‹¤ä»»åŠ¡å’Œè®°å½•æ ·ä¾‹

è¿™ç§æ•°æ®ç”Ÿæˆæ–¹å¼ç¡®ä¿äº†ç³»ç»Ÿå¯åŠ¨æ—¶å°±èƒ½æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´ã€å¯ç”¨çš„æµ‹è¯•ç¯å¢ƒï¼Œä¾¿äºå¼€å‘å’Œæµ‹è¯•ç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½ã€‚

---

é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ·±å…¥ç†è§£ CSISP åç«¯åˆå§‹åŒ–è„šæœ¬çš„å·¥ä½œåŸç†å’Œè®¾è®¡æ€æƒ³ã€‚æ‰€æœ‰ä¸‰ä¸ªæ“ä½œç³»ç»Ÿï¼ˆmacOSã€Linuxå’ŒWindowsï¼‰çš„è„šæœ¬éƒ½éµå¾ªç›¸åŒçš„è®¾è®¡åŸåˆ™ï¼Œå®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ ¹æ®å„å¹³å°çš„ç‰¹æ€§è¿›è¡Œäº†é€‚å½“çš„è°ƒæ•´ã€‚

è„šæœ¬çš„æ¯ä¸ªç¯èŠ‚éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¯é ã€ä¸€è‡´çš„å¼€å‘ç¯å¢ƒé…ç½®æµç¨‹ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šè®¾ç½®ç›¸åŒçš„å¼€å‘ç¯å¢ƒã€‚

å¦‚éœ€ä¿®æ”¹è„šæœ¬æˆ–ç†è§£æŸä¸ªå…·ä½“ç¯èŠ‚ï¼Œè¯·å‚è€ƒæœ¬æ–‡æ¡£çš„è¯¦ç»†è¯´æ˜ï¼Œç¡®ä¿å¯¹æ•´ä¸ªç³»ç»Ÿæœ‰å…¨é¢çš„è®¤è¯†ã€‚åœ¨ä¿®æ”¹è„šæœ¬æ—¶ï¼Œè¯·ç¡®ä¿åŒæ—¶æ›´æ–°æ‰€æœ‰ä¸‰ä¸ªå¹³å°çš„ç‰ˆæœ¬ï¼Œä»¥ä¿æŒåŠŸèƒ½ä¸€è‡´æ€§ã€‚
