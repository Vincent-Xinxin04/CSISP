# TypeScript 数据模型类型说明文档

本文档以 TypeScript 类型系统的思维方式，定义和说明系统中所有核心数据模型的类型结构，并提供数据生成规则。

## 1. 基础类型定义

首先，我们定义一些基础的枚举和类型，这些将在后续的接口定义中复用：

```typescript
// 通用状态枚举
export enum Status {
  Active = 1, // 活跃/可用/在职/进行中/有效
  Inactive = 0, // 禁用/离职/已结束/无效
}

// 学期枚举
export enum Semester {
  First = 1,
  Second = 2,
  Third = 3,
  Fourth = 4,
  Fifth = 5,
  Sixth = 6,
  Seventh = 7,
  Eighth = 8,
}

// 时间戳类型
export type Timestamp = Date;

// 专业数组类型
export type MajorList = string[];
```

## 2. 用户模型 (User)

```typescript
export interface User {
  id: number; // 用户唯一标识符
  username: string; // 用户名（唯一）
  password: string; // 密码（加密存储）
  studentId: string; // 学号（唯一，11位字符串）
  enrollmentYear: number; // 入学年份（范围：2000-3000）
  major: string; // 专业名称
  realName: string; // 真实姓名
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建用户时的输入类型（不含自动生成的字段）
export interface CreateUserInput extends Omit<User, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新用户时的输入类型（不含自动生成的字段和不可更新字段）
export interface UpdateUserInput
  extends Partial<
    Omit<User, 'id' | 'username' | 'studentId' | 'enrollmentYear' | 'createdAt' | 'updatedAt'>
  > {}
```

## 3. 课程模型 (Course)

```typescript
export interface Course {
  id: number; // 课程唯一标识符
  courseName: string; // 课程名称
  courseCode: string; // 课程代码
  semester: Semester; // 学期
  academicYear: number; // 学年
  availableMajors: MajorList; // 可选择的专业列表
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 组合唯一约束：同一课程代码在同一学年同一学期只能开设一次
export interface CourseUniqueConstraint {
  courseCode: string;
  semester: Semester;
  academicYear: number;
}

// 创建课程时的输入类型
export interface CreateCourseInput extends Omit<Course, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新课程时的输入类型
export interface UpdateCourseInput
  extends Partial<
    Omit<Course, 'id' | 'courseCode' | 'semester' | 'academicYear' | 'createdAt' | 'updatedAt'>
  > {}
```

## 4. 教师模型 (Teacher)

```typescript
export interface Teacher {
  id: number; // 教师唯一标识符
  userId: number; // 关联用户ID（外键）
  teacherId: string; // 教师工号（唯一，11位字符串）
  realName: string; // 真实姓名
  email: string; // 邮箱（唯一）
  phone: string; // 手机号（唯一）
  department: string; // 所属部门
  title: string; // 职称
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建教师时的输入类型
export interface CreateTeacherInput extends Omit<Teacher, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新教师时的输入类型
export interface UpdateTeacherInput
  extends Partial<Omit<Teacher, 'id' | 'userId' | 'teacherId' | 'createdAt' | 'updatedAt'>> {}
```

## 5. 班级模型 (Class)

**说明：** 根据业务文档，系统采用"课程即班级"的模型，无固定行政班级概念。班级直接与课程关联，代表特定课程的具体教学单元。

```typescript
export interface Class {
  id: number; // 班级唯一标识符
  className: string; // 班级名称
  courseId: number; // 所属课程ID（外键）
  teacherId: number; // 授课教师ID（外键）
  semester: Semester; // 学期
  academicYear: number; // 学年
  maxStudents: number; // 最大学生数（默认50）
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建班级时的输入类型
export interface CreateClassInput extends Omit<Class, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新班级时的输入类型
export interface UpdateClassInput
  extends Partial<
    Omit<
      Class,
      'id' | 'courseId' | 'teacherId' | 'semester' | 'academicYear' | 'createdAt' | 'updatedAt'
    >
  > {}
```

## 6. 用户班级关联模型 (UserClass)

**说明：** 表示学生选修特定课程班级的关系，体现"课程即班级"模型中学生与具体教学单元的关联。

```typescript
export interface UserClass {
  id: number; // 关联唯一标识符
  userId: number; // 用户ID（外键，级联删除）
  classId: number; // 班级ID（外键，级联删除）
  joinTime: Timestamp; // 加入时间
  status: Status; // 状态
}

// 组合唯一约束：用户与班级的组合唯一
export interface UserClassUniqueConstraint {
  userId: number;
  classId: number;
}

// 创建关联时的输入类型
export interface CreateUserClassInput extends Omit<UserClass, 'id' | 'joinTime'> {}

// 更新关联时的输入类型
export interface UpdateUserClassInput
  extends Partial<Omit<UserClass, 'id' | 'userId' | 'classId' | 'joinTime'>> {}
```

## 7. 子课程模型 (SubCourse)

**说明：** 根据业务文档，子课程代表具体的教学实施单元，与课程是一对多关系，与班级是一对多关系。

```typescript
export interface SubCourse {
  id: number; // 子课程唯一标识符
  courseId: number; // 所属课程ID（外键）
  subCourseCode: string; // 子课程标识
  teacherId: number; // 授课教师ID（外键）
  academicYear: number; // 学年
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建子课程时的输入类型
export interface CreateSubCourseInput extends Omit<SubCourse, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新子课程时的输入类型
export interface UpdateSubCourseInput
  extends Partial<
    Omit<SubCourse, 'id' | 'courseId' | 'subCourseCode' | 'createdAt' | 'updatedAt'>
  > {}
```

## 8. 课代表模型 (CourseRep)

**说明：** 表示学生担任课程课代表的关系，一个班级可以有多个课代表负责不同职责。

```typescript
export interface CourseRep {
  id: number; // 课代表唯一标识符
  userId: number; // 学生用户ID（外键）
  classId: number; // 所属班级ID（外键）
  responsibility: string; // 职责描述
  appointmentDate: Timestamp; // 任命日期
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建课代表时的输入类型
export interface CreateCourseRepInput
  extends Omit<CourseRep, 'id' | 'appointmentDate' | 'createdAt' | 'updatedAt'> {}

// 更新课代表时的输入类型
export interface UpdateCourseRepInput
  extends Partial<
    Omit<CourseRep, 'id' | 'userId' | 'classId' | 'appointmentDate' | 'createdAt' | 'updatedAt'>
  > {}
```

## 9. 时间段模型 (TimeSlot)

**说明：** 表示课程的具体上课时间段和地点信息。

```typescript
export interface TimeSlot {
  id: number; // 时间段唯一标识符
  subCourseId: number; // 所属子课程ID（外键）
  weekday: number; // 星期几（1-7）
  startTime: string; // 开始时间
  endTime: string; // 结束时间
  location: string; // 上课地点
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建时间段时的输入类型
export interface CreateTimeSlotInput extends Omit<TimeSlot, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新时间段时的输入类型
export interface UpdateTimeSlotInput
  extends Partial<Omit<TimeSlot, 'id' | 'subCourseId' | 'createdAt' | 'updatedAt'>> {}
```

## 10. 学术配置模型 (AcademicConfig)

```typescript
export interface AcademicConfig {
  id: number; // 配置唯一标识符
  configKey: string; // 配置键名
  configValue: string; // 配置值
  description: string; // 配置描述
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建配置时的输入类型
export interface CreateAcademicConfigInput
  extends Omit<AcademicConfig, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新配置时的输入类型
export interface UpdateAcademicConfigInput
  extends Partial<Omit<AcademicConfig, 'id' | 'configKey' | 'createdAt' | 'updatedAt'>> {}
```

## 11. 考勤任务模型 (AttendanceTask)

```typescript
export interface AttendanceTask {
  id: number; // 任务唯一标识符
  classId: number; // 班级ID（外键）
  taskName: string; // 任务名称
  taskType: string; // 任务类型
  startTime: Timestamp; // 开始时间
  endTime: Timestamp; // 结束时间
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建考勤任务时的输入类型
export interface CreateAttendanceTaskInput
  extends Omit<AttendanceTask, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新考勤任务时的输入类型
export interface UpdateAttendanceTaskInput
  extends Partial<Omit<AttendanceTask, 'id' | 'classId' | 'createdAt' | 'updatedAt'>> {}
```

## 12. 考勤记录模型 (AttendanceRecord)

```typescript
export interface AttendanceRecord {
  id: number; // 记录唯一标识符
  attendanceTaskId: number; // 考勤任务ID（外键）
  userId: number; // 用户ID（外键）
  status: string; // 考勤状态
  remark: string; // 备注
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建考勤记录时的输入类型
export interface CreateAttendanceRecordInput
  extends Omit<AttendanceRecord, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新考勤记录时的输入类型
export interface UpdateAttendanceRecordInput
  extends Partial<
    Omit<AttendanceRecord, 'id' | 'attendanceTaskId' | 'userId' | 'createdAt' | 'updatedAt'>
  > {}
```

## 13. 作业模型 (Homework)

```typescript
export interface Homework {
  id: number; // 作业唯一标识符
  classId: number; // 班级ID（外键）
  title: string; // 作业标题
  content: string; // 作业内容
  deadline: Timestamp; // 截止时间
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建作业时的输入类型
export interface CreateHomeworkInput extends Omit<Homework, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新作业时的输入类型
export interface UpdateHomeworkInput
  extends Partial<Omit<Homework, 'id' | 'classId' | 'createdAt' | 'updatedAt'>> {}
```

## 14. 作业提交模型 (HomeworkSubmission)

```typescript
export interface HomeworkSubmission {
  id: number; // 提交唯一标识符
  homeworkId: number; // 作业ID（外键）
  userId: number; // 用户ID（外键）
  content: string; // 提交内容
  fileUrl?: string; // 附件URL（可选，见 HomeworkFile）
  score?: number; // 分数
  feedback?: string; // 教师反馈
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 作业附件模型
export interface HomeworkFile {
  id: number; // 附件唯一标识符
  submissionId: number; // 提交ID（外键）
  fileName: string; // 文件名
  filePath: string; // 文件存储路径
  fileSize?: number; // 文件大小（可选）
  fileType?: string; // 文件类型（可选）
  uploadTime: Timestamp; // 上传时间
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建作业提交时的输入类型
export interface CreateHomeworkSubmissionInput
  extends Omit<HomeworkSubmission, 'id' | 'score' | 'feedback' | 'createdAt' | 'updatedAt'> {}

// 更新作业提交时的输入类型
export interface UpdateHomeworkSubmissionInput
  extends Partial<
    Omit<HomeworkSubmission, 'id' | 'homeworkId' | 'userId' | 'createdAt' | 'updatedAt'>
  > {}
```

## 15. 通知模型 (Notification)

```typescript
export interface Notification {
  id: number; // 通知唯一标识符
  title: string; // 通知标题
  content: string; // 通知内容
  senderId: number; // 发送者ID
  receiverId: number; // 接收者ID
  type: string; // 通知类型
  read: boolean; // 是否已读
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建通知时的输入类型
export interface CreateNotificationInput
  extends Omit<Notification, 'id' | 'read' | 'createdAt' | 'updatedAt'> {}

// 更新通知时的输入类型
export interface UpdateNotificationInput
  extends Partial<
    Omit<Notification, 'id' | 'senderId' | 'receiverId' | 'createdAt' | 'updatedAt'>
  > {}
```

## 16. 权限模型 (Permission)

```typescript
export interface Permission {
  id: number; // 权限唯一标识符
  name: string; // 权限名称
  code: string; // 权限代码
  description: string; // 权限描述
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建权限时的输入类型
export interface CreatePermissionInput extends Omit<Permission, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新权限时的输入类型
export interface UpdatePermissionInput
  extends Partial<Omit<Permission, 'id' | 'code' | 'createdAt' | 'updatedAt'>> {}
```

## 17. 角色模型 (Role)

```typescript
export interface Role {
  id: number; // 角色唯一标识符
  name: string; // 角色名称
  code: string; // 角色代码
  description: string; // 角色描述
  status: Status; // 状态
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建角色时的输入类型
export interface CreateRoleInput extends Omit<Role, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新角色时的输入类型
export interface UpdateRoleInput
  extends Partial<Omit<Role, 'id' | 'code' | 'createdAt' | 'updatedAt'>> {}
```

## 18. 课程表模型 (Schedule)

```typescript
export interface Schedule {
  id: number; // 课程表唯一标识符
  userId: number; // 用户ID（外键）
  className: string; // 课程名称
  teacherName: string; // 教师名称
  weekday: number; // 星期几（1-7）
  startTime: string; // 开始时间
  endTime: string; // 结束时间
  location: string; // 上课地点
  color: string; // 颜色标记
  createdAt: Timestamp; // 创建时间
  updatedAt: Timestamp; // 更新时间
}

// 创建课程表时的输入类型
export interface CreateScheduleInput extends Omit<Schedule, 'id' | 'createdAt' | 'updatedAt'> {}

// 更新课程表时的输入类型
export interface UpdateScheduleInput
  extends Partial<Omit<Schedule, 'id' | 'userId' | 'createdAt' | 'updatedAt'>> {}
```

## 19. 数据生成规则

### 19.1 学号生成规则

- **格式**：11位字符串
- **结构**：`YYYYMMDDXXX`
  - `YYYY`：入学年份（4位）
  - `MM`：学院代码（2位）
  - `DD`：专业代码（2位）
  - `XXX`：序号（3位，从001开始）
- **示例**：`20230102001` 表示2023年入学，学院代码01，专业代码02，序号001的学生
- **生成算法**：
  ```typescript
  function generateStudentId(
    enrollmentYear: number,
    collegeCode: string,
    majorCode: string,
    sequence: number
  ): string {
    return `${enrollmentYear}${collegeCode}${majorCode}${sequence.toString().padStart(3, '0')}`;
  }
  ```

### 19.2 教师工号生成规则

- **格式**：11位字符串
- **结构**：`TYYYYMMDDXXX`
  - `T`：教师类型标识
  - `YYYY`：入职年份（4位）
  - `MM`：部门代码（2位）
  - `DD`：职称代码（2位）
  - `XXX`：序号（3位，从001开始）
- **示例**：`T20200305001` 表示2020年入职，部门代码03，职称代码05，序号001的教师
- **生成算法**：
  ```typescript
  function generateTeacherId(
    hireYear: number,
    departmentCode: string,
    titleCode: string,
    sequence: number
  ): string {
    return `T${hireYear}${departmentCode}${titleCode}${sequence.toString().padStart(3, '0')}`;
  }
  ```

### 19.3 班级数量规则

- 每个课程每学期最多开设5个班级
- 每个班级最大学生数默认50人，可根据课程性质调整
- 教师每学期最多同时教授10个班级
- 学生每学期最多选修8个课程

### 19.4 课程代码规则

- **格式**：8位字符串
- **结构**：`ABCD1234`
  - `ABCD`：课程类别代码（4位字母）
  - `1234`：课程序号（4位数字）
- **示例**：`COMP1001` 表示计算机类第1001号课程
- **验证正则**：`^[A-Z]{4}\d{4}$`

### 19.5 数据范围规则

- 入学年份范围：2000-3000
- 学期范围：1-8（对应本科四年八个学期）
- 手机号码格式：中国大陆11位手机号（验证正则：`^1[3-9]\d{9}$`）
- 邮箱格式：标准邮箱格式（验证正则：`^[^\s@]+@[^\s@]+\.[^\s@]+$`）

### 19.6 关联数据生成策略

- 用户和教师的关联：通过userId字段一对一关联
- 用户和班级的关联：通过user_class中间表多对多关联
- 教师和班级的关联：通过teacherId外键一对多关联
- 课程和班级的关联：通过courseId外键一对多关联

### 19.7 初始数据生成建议

- 用户数据：建议生成至少800名学生，覆盖不同年级、专业，要求每个年级都有200个左右数量的学生
- 教师数据：建议生成至少20名教师，覆盖不同部门、职称
- 课程数据：建议生成至少50门课程，覆盖不同类别、专业需求
- 班级数据：建议生成至少80个班级，合理分配教师和学生
- 关联数据：确保每个学生至少选修3门课程，每个教师至少教授3个班级

## 20. 类型使用注意事项

1. 所有时间戳字段在API层面统一使用ISO 8601格式字符串传输
2. 枚举类型在数据库中以整数形式存储，在API响应中可选择返回枚举名称
3. 所有唯一性约束需要在应用层进行验证，确保数据一致性
4. 外键关联在删除操作时使用级联删除策略，避免数据孤立
5. 状态字段应始终使用Status枚举，避免硬编码数字值

本说明文档以TypeScript类型系统为基础，为前后端开发提供统一的数据模型定义和数据生成规范，确保系统实现的数据一致性。
